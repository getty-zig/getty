<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>require.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTQwIj48ZyBmaWxsPSIjRjdBNDFEIj48Zz48cG9seWdvbiBwb2ludHM9IjQ2LDIyIDI4LDQ0IDE5LDMwIi8+PHBvbHlnb24gcG9pbnRzPSI0NiwyMiAzMywzMyAyOCw0NCAyMiw0NCAyMiw5NSAzMSw5NSAyMCwxMDAgMTIsMTE3IDAsMTE3IDAsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMzEsOTUgMTIsMTE3IDQsMTA2Ii8+PC9nPjxnPjxwb2x5Z29uIHBvaW50cz0iNTYsMjIgNjIsMzYgMzcsNDQiLz48cG9seWdvbiBwb2ludHM9IjU2LDIyIDExMSwyMiAxMTEsNDQgMzcsNDQgNTYsMzIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTE2LDk1IDk3LDExNyA5MCwxMDQiLz48cG9seWdvbiBwb2ludHM9IjExNiw5NSAxMDAsMTA0IDk3LDExNyA0MiwxMTcgNDIsOTUiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTUwLDAgNTIsMTE3IDMsMTQwIDEwMSwyMiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjE0MSwyMiAxNDAsNDAgMTIyLDQ1Ii8+PHBvbHlnb24gcG9pbnRzPSIxNTMsMjIgMTUzLDExNyAxMDYsMTE3IDEyMCwxMDUgMTI1LDk1IDEzMSw5NSAxMzEsNDUgMTIyLDQ1IDEzMiwzNiAxNDEsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTI1LDk1IDEzMCwxMTAgMTA2LDExNyIvPjwvZz48L2c+PC9zdmc+">
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L2"></span>
<span class="line" id="L3"><span class="tok-kw">const</span> fmt = std.fmt;</span>
<span class="line" id="L4"><span class="tok-kw">const</span> io = std.io;</span>
<span class="line" id="L5"><span class="tok-kw">const</span> mem = std.mem;</span>
<span class="line" id="L6"><span class="tok-kw">const</span> meta = std.meta;</span>
<span class="line" id="L7"></span>
<span class="line" id="L8"><span class="tok-kw">const</span> ArrayList = std.ArrayList;</span>
<span class="line" id="L9"><span class="tok-kw">const</span> assert = std.debug.assert;</span>
<span class="line" id="L10"><span class="tok-kw">const</span> print = std.debug.print;</span>
<span class="line" id="L11"><span class="tok-kw">const</span> test_ally = std.testing.allocator;</span>
<span class="line" id="L12"></span>
<span class="line" id="L13"><span class="tok-comment">/// Asserts that the specified string, array, slice, or tuple contains the</span></span>
<span class="line" id="L14"><span class="tok-comment">/// specified substring or element.</span></span>
<span class="line" id="L15"><span class="tok-comment">///</span></span>
<span class="line" id="L16"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L17"><span class="tok-comment">/// try require.contains(&quot;Hello World&quot;, 'W');</span></span>
<span class="line" id="L18"><span class="tok-comment">/// try require.contains(&quot;Hello World&quot;, &quot;World&quot;);</span></span>
<span class="line" id="L19"><span class="tok-comment">/// try require.contains(.{ &quot;Hello&quot;, &quot;World&quot; }, &quot;World&quot;);</span></span>
<span class="line" id="L20"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L21"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">contains</span>(haystack: <span class="tok-kw">anytype</span>, needle: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L22">    <span class="tok-kw">try</span> containsf(haystack, needle, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L23">}</span>
<span class="line" id="L24"></span>
<span class="line" id="L25"><span class="tok-comment">/// Asserts that the specified string, array, slice, or tuple contains the</span></span>
<span class="line" id="L26"><span class="tok-comment">/// specified substring or element.</span></span>
<span class="line" id="L27"><span class="tok-comment">///</span></span>
<span class="line" id="L28"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L29"><span class="tok-comment">/// try require.containsf(&quot;Hello World&quot;, 'W', &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L30"><span class="tok-comment">/// try require.containsf(&quot;Hello World&quot;, &quot;World&quot;, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L31"><span class="tok-comment">/// try require.containsf(.{ &quot;Hello&quot;, &quot;World&quot; }, &quot;World&quot;, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L32"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L33"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">containsf</span>(</span>
<span class="line" id="L34">    haystack: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L35">    needle: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L36">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L37">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L38">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L39">    <span class="tok-kw">const</span> Haystack = <span class="tok-builtin">@TypeOf</span>(haystack);</span>
<span class="line" id="L40">    <span class="tok-kw">const</span> Needle = <span class="tok-builtin">@TypeOf</span>(needle);</span>
<span class="line" id="L41"></span>
<span class="line" id="L42">    <span class="tok-kw">if</span> (!containsElement(haystack, needle)) {</span>
<span class="line" id="L43">        <span class="tok-kw">const</span> f = <span class="tok-kw">comptime</span> f: {</span>
<span class="line" id="L44">            <span class="tok-kw">const</span> haystack_is_str = isString(Haystack);</span>
<span class="line" id="L45">            <span class="tok-kw">const</span> needle_is_str = isString(Needle);</span>
<span class="line" id="L46"></span>
<span class="line" id="L47">            <span class="tok-kw">if</span> (haystack_is_str <span class="tok-kw">and</span> needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L48">            <span class="tok-str">\\&quot;{s}&quot; does not contain &quot;{s}&quot;</span></span>

<span class="line" id="L49">            ;</span>
<span class="line" id="L50">            <span class="tok-kw">if</span> (!haystack_is_str <span class="tok-kw">and</span> !needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L51">            <span class="tok-str">\\{any} does not contain {any}</span></span>

<span class="line" id="L52">            ;</span>
<span class="line" id="L53">            <span class="tok-kw">if</span> (haystack_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L54">            <span class="tok-str">\\&quot;{s}&quot; does not contain &quot;{u}&quot;</span></span>

<span class="line" id="L55">            ;</span>
<span class="line" id="L56">            <span class="tok-kw">if</span> (needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L57">            <span class="tok-str">\\{any} does not contain &quot;{s}&quot;</span></span>

<span class="line" id="L58">            ;</span>
<span class="line" id="L59">        };</span>
<span class="line" id="L60">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(f, .{ haystack, needle });</span>
<span class="line" id="L61">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L62"></span>
<span class="line" id="L63">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L64">    }</span>
<span class="line" id="L65">}</span>
<span class="line" id="L66"></span>
<span class="line" id="L67"><span class="tok-comment">/// Asserts that the specified listA is equal to specified listB ignoring the</span></span>
<span class="line" id="L68"><span class="tok-comment">/// order of the elements. If there are duplicate elements, the number of</span></span>
<span class="line" id="L69"><span class="tok-comment">/// appearances of each of them in both lists should match.</span></span>
<span class="line" id="L70"><span class="tok-comment">///</span></span>
<span class="line" id="L71"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L72"><span class="tok-comment">/// try require.elementsMatch(.{ 1, 2, 3 }, .{ 1, 2, 3 });</span></span>
<span class="line" id="L73"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L74"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">elementsMatch</span>(listA: <span class="tok-kw">anytype</span>, listB: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L75">    <span class="tok-kw">try</span> elementsMatchf(listA, listB, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L76">}</span>
<span class="line" id="L77"></span>
<span class="line" id="L78"><span class="tok-comment">/// Asserts that the specified listA is equal to specified listB ignoring the</span></span>
<span class="line" id="L79"><span class="tok-comment">/// order of the elements. If there are duplicate elements, the number of</span></span>
<span class="line" id="L80"><span class="tok-comment">/// appearances of each of them in both lists should match.</span></span>
<span class="line" id="L81"><span class="tok-comment">///</span></span>
<span class="line" id="L82"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L83"><span class="tok-comment">/// try require.elementsMatchf(.{ 1, 2, 3 }, .{ 1, 3, 2 }, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L84"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L85"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">elementsMatchf</span>(</span>
<span class="line" id="L86">    listA: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L87">    listB: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L88">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L89">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L90">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L91">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L92">        <span class="tok-kw">if</span> (!isList(<span class="tok-builtin">@TypeOf</span>(listA))) {</span>
<span class="line" id="L93">            <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L94">                <span class="tok-str">&quot;expected 'listA' to be a list, found '{s}'&quot;</span>,</span>
<span class="line" id="L95">                .{<span class="tok-builtin">@typeName</span>(<span class="tok-builtin">@TypeOf</span>(listA))},</span>
<span class="line" id="L96">            );</span>
<span class="line" id="L97">            <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L98">        }</span>
<span class="line" id="L99"></span>
<span class="line" id="L100">        <span class="tok-kw">if</span> (!isList(<span class="tok-builtin">@TypeOf</span>(listB))) {</span>
<span class="line" id="L101">            <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L102">                <span class="tok-str">&quot;expected 'listB' to be a list, found '{s}'&quot;</span>,</span>
<span class="line" id="L103">                .{<span class="tok-builtin">@typeName</span>(<span class="tok-builtin">@TypeOf</span>(listB))},</span>
<span class="line" id="L104">            );</span>
<span class="line" id="L105">            <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L106">        }</span>
<span class="line" id="L107">    }</span>
<span class="line" id="L108"></span>
<span class="line" id="L109">    <span class="tok-kw">if</span> (isEmpty(listA) <span class="tok-kw">and</span> isEmpty(listB)) {</span>
<span class="line" id="L110">        <span class="tok-kw">return</span>;</span>
<span class="line" id="L111">    }</span>
<span class="line" id="L112"></span>
<span class="line" id="L113">    <span class="tok-kw">const</span> extra = <span class="tok-kw">try</span> diffLists(listA, listB);</span>
<span class="line" id="L114">    <span class="tok-kw">defer</span> {</span>
<span class="line" id="L115">        test_ally.free(extra[<span class="tok-number">0</span>]);</span>
<span class="line" id="L116">        test_ally.free(extra[<span class="tok-number">1</span>]);</span>
<span class="line" id="L117">    }</span>
<span class="line" id="L118">    <span class="tok-kw">const</span> extraA = extra[<span class="tok-number">0</span>];</span>
<span class="line" id="L119">    <span class="tok-kw">const</span> extraB = extra[<span class="tok-number">1</span>];</span>
<span class="line" id="L120"></span>
<span class="line" id="L121">    <span class="tok-kw">if</span> (extraA.len == <span class="tok-number">0</span> <span class="tok-kw">and</span> extraB.len == <span class="tok-number">0</span>) {</span>
<span class="line" id="L122">        <span class="tok-kw">return</span>;</span>
<span class="line" id="L123">    }</span>
<span class="line" id="L124"></span>
<span class="line" id="L125">    <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> formatDiffList(listA, listB, extraA, extraB);</span>
<span class="line" id="L126">    <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L127">    <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L128">}</span>
<span class="line" id="L129"></span>
<span class="line" id="L130"><span class="tok-comment">/// Asserts that two values are equal.</span></span>
<span class="line" id="L131"><span class="tok-comment">///</span></span>
<span class="line" id="L132"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L133"><span class="tok-comment">/// try require.equal(123, 123);</span></span>
<span class="line" id="L134"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L135"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equal</span>(expected: <span class="tok-kw">anytype</span>, value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L136">    <span class="tok-kw">try</span> equalf(expected, value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L137">}</span>
<span class="line" id="L138"></span>
<span class="line" id="L139"><span class="tok-comment">/// Asserts that two values are equal.</span></span>
<span class="line" id="L140"><span class="tok-comment">///</span></span>
<span class="line" id="L141"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L142"><span class="tok-comment">/// try require.equalf(123, 123, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L143"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L144"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equalf</span>(</span>
<span class="line" id="L145">    expected: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L146">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L147">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L148">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L149">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L150">    <span class="tok-kw">const</span> Expected = <span class="tok-builtin">@TypeOf</span>(expected);</span>
<span class="line" id="L151">    <span class="tok-kw">const</span> Value = <span class="tok-builtin">@TypeOf</span>(value);</span>
<span class="line" id="L152"></span>
<span class="line" id="L153">    <span class="tok-kw">if</span> (!deepEqual(expected, value)) {</span>
<span class="line" id="L154">        <span class="tok-kw">const</span> f = <span class="tok-kw">comptime</span> f: {</span>
<span class="line" id="L155">            <span class="tok-kw">const</span> expected_str = isString(Expected);</span>
<span class="line" id="L156">            <span class="tok-kw">const</span> value_str = isString(Value);</span>
<span class="line" id="L157"></span>
<span class="line" id="L158">            <span class="tok-kw">if</span> (expected_str <span class="tok-kw">and</span> value_str) {</span>
<span class="line" id="L159">                <span class="tok-kw">break</span> :f </span>
<span class="line" id="L160">                <span class="tok-str">\\Not equal:</span></span>

<span class="line" id="L161">                <span class="tok-str">\\</span></span>

<span class="line" id="L162">                <span class="tok-str">\\expected:</span></span>

<span class="line" id="L163">                <span class="tok-str">\\&quot;{s}&quot;</span></span>

<span class="line" id="L164">                <span class="tok-str">\\</span></span>

<span class="line" id="L165">                <span class="tok-str">\\actual:</span></span>

<span class="line" id="L166">                <span class="tok-str">\\&quot;{s}&quot;</span></span>

<span class="line" id="L167">                ;</span>
<span class="line" id="L168">            }</span>
<span class="line" id="L169">            <span class="tok-kw">if</span> (!expected_str <span class="tok-kw">and</span> !value_str) {</span>
<span class="line" id="L170">                <span class="tok-kw">break</span> :f </span>
<span class="line" id="L171">                <span class="tok-str">\\Not equal:</span></span>

<span class="line" id="L172">                <span class="tok-str">\\</span></span>

<span class="line" id="L173">                <span class="tok-str">\\expected:</span></span>

<span class="line" id="L174">                <span class="tok-str">\\{any}</span></span>

<span class="line" id="L175">                <span class="tok-str">\\</span></span>

<span class="line" id="L176">                <span class="tok-str">\\actual:</span></span>

<span class="line" id="L177">                <span class="tok-str">\\{any}</span></span>

<span class="line" id="L178">                ;</span>
<span class="line" id="L179">            }</span>
<span class="line" id="L180">            <span class="tok-kw">if</span> (expected_str) {</span>
<span class="line" id="L181">                <span class="tok-kw">break</span> :f </span>
<span class="line" id="L182">                <span class="tok-str">\\Not equal:</span></span>

<span class="line" id="L183">                <span class="tok-str">\\</span></span>

<span class="line" id="L184">                <span class="tok-str">\\expected:</span></span>

<span class="line" id="L185">                <span class="tok-str">\\&quot;{s}&quot;</span></span>

<span class="line" id="L186">                <span class="tok-str">\\</span></span>

<span class="line" id="L187">                <span class="tok-str">\\actual:</span></span>

<span class="line" id="L188">                <span class="tok-str">\\{any}</span></span>

<span class="line" id="L189">                ;</span>
<span class="line" id="L190">            }</span>
<span class="line" id="L191">            <span class="tok-kw">if</span> (value_str) {</span>
<span class="line" id="L192">                <span class="tok-kw">break</span> :f </span>
<span class="line" id="L193">                <span class="tok-str">\\Not equal:</span></span>

<span class="line" id="L194">                <span class="tok-str">\\</span></span>

<span class="line" id="L195">                <span class="tok-str">\\expected:</span></span>

<span class="line" id="L196">                <span class="tok-str">\\{any}</span></span>

<span class="line" id="L197">                <span class="tok-str">\\</span></span>

<span class="line" id="L198">                <span class="tok-str">\\actual:</span></span>

<span class="line" id="L199">                <span class="tok-str">\\&quot;{s}&quot;</span></span>

<span class="line" id="L200">                ;</span>
<span class="line" id="L201">            }</span>
<span class="line" id="L202">        };</span>
<span class="line" id="L203">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(f, .{ expected, value });</span>
<span class="line" id="L204">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L205"></span>
<span class="line" id="L206">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L207">    }</span>
<span class="line" id="L208">}</span>
<span class="line" id="L209"></span>
<span class="line" id="L210"><span class="tok-comment">/// Asserts that the provided value is an error and that it is equal to the</span></span>
<span class="line" id="L211"><span class="tok-comment">/// provided error.</span></span>
<span class="line" id="L212"><span class="tok-comment">///</span></span>
<span class="line" id="L213"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L214"><span class="tok-comment">/// try require.equalError(error.Foo, foo());</span></span>
<span class="line" id="L215"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L216"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equalError</span>(</span>
<span class="line" id="L217">    expected: <span class="tok-type">anyerror</span>,</span>
<span class="line" id="L218">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L219">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L220">    <span class="tok-kw">try</span> equalErrorf(expected, value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L221">}</span>
<span class="line" id="L222"></span>
<span class="line" id="L223"><span class="tok-comment">/// Asserts that the provided value is an error and that it is equal to the</span></span>
<span class="line" id="L224"><span class="tok-comment">/// provided error.</span></span>
<span class="line" id="L225"><span class="tok-comment">///</span></span>
<span class="line" id="L226"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L227"><span class="tok-comment">/// try require.equalErrorf(error.Foo, foo(), &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L228"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L229"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equalErrorf</span>(</span>
<span class="line" id="L230">    expected: <span class="tok-type">anyerror</span>,</span>
<span class="line" id="L231">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L232">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L233">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L234">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L235">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L236"></span>
<span class="line" id="L237">    <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(value))) {</span>
<span class="line" id="L238">        .ErrorSet =&gt; {</span>
<span class="line" id="L239">            <span class="tok-kw">if</span> (value != expected) {</span>
<span class="line" id="L240">                <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L241">                    <span class="tok-str">\\Error not equal:</span></span>

<span class="line" id="L242">                    <span class="tok-str">\\</span></span>

<span class="line" id="L243">                    <span class="tok-str">\\expected:</span></span>

<span class="line" id="L244">                    <span class="tok-str">\\{}</span></span>

<span class="line" id="L245">                    <span class="tok-str">\\</span></span>

<span class="line" id="L246">                    <span class="tok-str">\\value:</span></span>

<span class="line" id="L247">                    <span class="tok-str">\\{}</span></span>

<span class="line" id="L248">                , .{ expected, value });</span>
<span class="line" id="L249">                <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L250"></span>
<span class="line" id="L251">                <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L252">            }</span>
<span class="line" id="L253">        },</span>
<span class="line" id="L254">        .ErrorUnion =&gt; {</span>
<span class="line" id="L255">            <span class="tok-kw">if</span> (value) |_| {</span>
<span class="line" id="L256">                <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(<span class="tok-str">&quot;Expected error, found '{any}'&quot;</span>, .{value});</span>
<span class="line" id="L257">                <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L258"></span>
<span class="line" id="L259">                <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L260">            } <span class="tok-kw">else</span> |err| {</span>
<span class="line" id="L261">                <span class="tok-kw">if</span> (err != expected) {</span>
<span class="line" id="L262">                    <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L263">                        <span class="tok-str">\\Error not equal:</span></span>

<span class="line" id="L264">                        <span class="tok-str">\\</span></span>

<span class="line" id="L265">                        <span class="tok-str">\\expected:</span></span>

<span class="line" id="L266">                        <span class="tok-str">\\{}</span></span>

<span class="line" id="L267">                        <span class="tok-str">\\</span></span>

<span class="line" id="L268">                        <span class="tok-str">\\value:</span></span>

<span class="line" id="L269">                        <span class="tok-str">\\{}</span></span>

<span class="line" id="L270">                    , .{ expected, err });</span>
<span class="line" id="L271">                    <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L272"></span>
<span class="line" id="L273">                    <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L274">                }</span>
<span class="line" id="L275">            }</span>
<span class="line" id="L276">        },</span>
<span class="line" id="L277">        <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L278">            <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(<span class="tok-str">&quot;Expected error, found '{}'&quot;</span>, .{value});</span>
<span class="line" id="L279">            <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L280"></span>
<span class="line" id="L281">            <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L282">        },</span>
<span class="line" id="L283">    }</span>
<span class="line" id="L284">}</span>
<span class="line" id="L285"></span>
<span class="line" id="L286"><span class="tok-comment">/// Asserts that the specified value is of the specified type.</span></span>
<span class="line" id="L287"><span class="tok-comment">///</span></span>
<span class="line" id="L288"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L289"><span class="tok-comment">/// try require.equalType(bool, true);</span></span>
<span class="line" id="L290"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L291"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equalType</span>(</span>
<span class="line" id="L292">    <span class="tok-kw">comptime</span> Expected: <span class="tok-type">type</span>,</span>
<span class="line" id="L293">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L294">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L295">    <span class="tok-kw">try</span> equalTypef(Expected, value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L296">}</span>
<span class="line" id="L297"></span>
<span class="line" id="L298"><span class="tok-comment">/// Asserts that the specified value is of the specified type.</span></span>
<span class="line" id="L299"><span class="tok-comment">///</span></span>
<span class="line" id="L300"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L301"><span class="tok-comment">/// try require.equalTypef(bool, true, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L302"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L303"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">equalTypef</span>(</span>
<span class="line" id="L304">    <span class="tok-kw">comptime</span> Expected: <span class="tok-type">type</span>,</span>
<span class="line" id="L305">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L306">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L307">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L308">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L309">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L310"></span>
<span class="line" id="L311">    <span class="tok-kw">const</span> Value = <span class="tok-builtin">@TypeOf</span>(value);</span>
<span class="line" id="L312"></span>
<span class="line" id="L313">    <span class="tok-kw">if</span> (Expected != Value) {</span>
<span class="line" id="L314">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L315">            <span class="tok-str">&quot;Expected type '{s}', found '{s}'&quot;</span>,</span>
<span class="line" id="L316">            .{ <span class="tok-builtin">@typeName</span>(Expected), <span class="tok-builtin">@typeName</span>(Value) },</span>
<span class="line" id="L317">        );</span>
<span class="line" id="L318">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L319"></span>
<span class="line" id="L320">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L321">    }</span>
<span class="line" id="L322">}</span>
<span class="line" id="L323"></span>
<span class="line" id="L324"><span class="tok-comment">/// Reports a failure.</span></span>
<span class="line" id="L325"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">fail</span>(fail_msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L326">    <span class="tok-kw">try</span> failf(fail_msg, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L327">}</span>
<span class="line" id="L328"></span>
<span class="line" id="L329"><span class="tok-comment">/// Reports a failure.</span></span>
<span class="line" id="L330"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">failf</span>(</span>
<span class="line" id="L331">    fail_msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L332">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L333">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L334">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L335">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L336"></span>
<span class="line" id="L337">    <span class="tok-kw">var</span> content = content: {</span>
<span class="line" id="L338">        <span class="tok-kw">const</span> cap: <span class="tok-type">usize</span> = <span class="tok-kw">if</span> (msg.len == <span class="tok-number">0</span>) <span class="tok-number">2</span> <span class="tok-kw">else</span> <span class="tok-number">3</span>;</span>
<span class="line" id="L339">        <span class="tok-kw">break</span> :content <span class="tok-kw">try</span> ArrayList(LabelContent).initCapacity(</span>
<span class="line" id="L340">            test_ally,</span>
<span class="line" id="L341">            cap,</span>
<span class="line" id="L342">        );</span>
<span class="line" id="L343">    };</span>
<span class="line" id="L344">    <span class="tok-kw">defer</span> content.deinit();</span>
<span class="line" id="L345"></span>
<span class="line" id="L346">    content.appendAssumeCapacity(.{</span>
<span class="line" id="L347">        .label = <span class="tok-str">&quot;Error&quot;</span>,</span>
<span class="line" id="L348">        .content = fail_msg,</span>
<span class="line" id="L349">    });</span>
<span class="line" id="L350"></span>
<span class="line" id="L351">    <span class="tok-kw">var</span> formatted_msg = formatted_msg: {</span>
<span class="line" id="L352">        <span class="tok-kw">var</span> formatted_msg = <span class="tok-kw">try</span> ArrayList(<span class="tok-type">u8</span>).initCapacity(</span>
<span class="line" id="L353">            test_ally,</span>
<span class="line" id="L354">            msg.len,</span>
<span class="line" id="L355">        );</span>
<span class="line" id="L356">        <span class="tok-kw">errdefer</span> formatted_msg.deinit();</span>
<span class="line" id="L357"></span>
<span class="line" id="L358">        <span class="tok-kw">if</span> (msg.len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L359">            <span class="tok-kw">try</span> fmt.format(formatted_msg.writer(), msg, args);</span>
<span class="line" id="L360"></span>
<span class="line" id="L361">            content.appendAssumeCapacity(.{</span>
<span class="line" id="L362">                .label = <span class="tok-str">&quot;Message&quot;</span>,</span>
<span class="line" id="L363">                .content = formatted_msg.items,</span>
<span class="line" id="L364">            });</span>
<span class="line" id="L365">        }</span>
<span class="line" id="L366">        <span class="tok-kw">break</span> :formatted_msg formatted_msg;</span>
<span class="line" id="L367">    };</span>
<span class="line" id="L368">    <span class="tok-kw">defer</span> formatted_msg.deinit();</span>
<span class="line" id="L369"></span>
<span class="line" id="L370">    content.appendAssumeCapacity(.{</span>
<span class="line" id="L371">        .label = <span class="tok-str">&quot;Error Trace&quot;</span>,</span>
<span class="line" id="L372">        .content = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L373">    });</span>
<span class="line" id="L374"></span>
<span class="line" id="L375">    <span class="tok-kw">const</span> output = <span class="tok-kw">try</span> labelOutput(content.items);</span>
<span class="line" id="L376">    <span class="tok-kw">defer</span> test_ally.free(output);</span>
<span class="line" id="L377"></span>
<span class="line" id="L378">    print(<span class="tok-str">&quot;\r\n\n&quot;</span>, .{});</span>
<span class="line" id="L379">    print(<span class="tok-str">&quot;{s}\n&quot;</span>, .{output});</span>
<span class="line" id="L380"></span>
<span class="line" id="L381">    <span class="tok-kw">return</span> <span class="tok-kw">error</span>.AssertionError;</span>
<span class="line" id="L382">}</span>
<span class="line" id="L383"></span>
<span class="line" id="L384"><span class="tok-comment">/// Asserts that a value is an error.</span></span>
<span class="line" id="L385"><span class="tok-comment">///</span></span>
<span class="line" id="L386"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L387"><span class="tok-comment">/// try require.isError(error.Foobar);</span></span>
<span class="line" id="L388"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L389"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isError</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L390">    <span class="tok-kw">try</span> isErrorf(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L391">}</span>
<span class="line" id="L392"></span>
<span class="line" id="L393"><span class="tok-comment">/// Asserts that a value is an error.</span></span>
<span class="line" id="L394"><span class="tok-comment">///</span></span>
<span class="line" id="L395"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L396"><span class="tok-comment">/// try require.isErrorf(error.Foobar, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L397"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L398"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isErrorf</span>(</span>
<span class="line" id="L399">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L400">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L401">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L402">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L403">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L404"></span>
<span class="line" id="L405">    <span class="tok-kw">if</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(value)) != .ErrorSet) {</span>
<span class="line" id="L406">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(<span class="tok-str">&quot;Expected error, found '{any}'&quot;</span>, .{value});</span>
<span class="line" id="L407">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L408"></span>
<span class="line" id="L409">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L410">    }</span>
<span class="line" id="L411">}</span>
<span class="line" id="L412"></span>
<span class="line" id="L413"><span class="tok-comment">/// Asserts that the specified value is false.</span></span>
<span class="line" id="L414"><span class="tok-comment">///</span></span>
<span class="line" id="L415"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L416"><span class="tok-comment">/// try require.isFalse(false);</span></span>
<span class="line" id="L417"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L418"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isFalse</span>(value: <span class="tok-type">bool</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L419">    <span class="tok-kw">try</span> isFalsef(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L420">}</span>
<span class="line" id="L421"></span>
<span class="line" id="L422"><span class="tok-comment">/// Asserts that the specified value is false.</span></span>
<span class="line" id="L423"><span class="tok-comment">///</span></span>
<span class="line" id="L424"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L425"><span class="tok-comment">/// try require.isFalsef(false, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L426"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L427"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isFalsef</span>(</span>
<span class="line" id="L428">    value: <span class="tok-type">bool</span>,</span>
<span class="line" id="L429">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L430">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L431">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L432">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L433"></span>
<span class="line" id="L434">    <span class="tok-kw">if</span> (value) {</span>
<span class="line" id="L435">        <span class="tok-kw">try</span> failf(<span class="tok-str">&quot;Should be false&quot;</span>, msg, args);</span>
<span class="line" id="L436">    }</span>
<span class="line" id="L437">}</span>
<span class="line" id="L438"></span>
<span class="line" id="L439"><span class="tok-comment">/// Asserts that the first value is greater than the second.</span></span>
<span class="line" id="L440"><span class="tok-comment">///</span></span>
<span class="line" id="L441"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L442"><span class="tok-comment">/// try require.isGreater(2, 1);</span></span>
<span class="line" id="L443"><span class="tok-comment">/// try require.isGreater(2.0, 1.0);</span></span>
<span class="line" id="L444"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L445"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isGreater</span>(v1: <span class="tok-kw">anytype</span>, v2: <span class="tok-builtin">@TypeOf</span>(v1)) !<span class="tok-type">void</span> {</span>
<span class="line" id="L446">    <span class="tok-kw">try</span> isGreaterf(v1, v2, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L447">}</span>
<span class="line" id="L448"></span>
<span class="line" id="L449"><span class="tok-comment">/// Asserts that the first value is greater than the second.</span></span>
<span class="line" id="L450"><span class="tok-comment">///</span></span>
<span class="line" id="L451"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L452"><span class="tok-comment">/// try require.isGreaterf(2, 1, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L453"><span class="tok-comment">/// try require.isGreaterf(2.0, 1.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L454"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L455"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isGreaterf</span>(</span>
<span class="line" id="L456">    v1: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L457">    v2: <span class="tok-builtin">@TypeOf</span>(v1),</span>
<span class="line" id="L458">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L459">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L460">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L461">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L462">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(v1));</span>
<span class="line" id="L463"></span>
<span class="line" id="L464">    <span class="tok-kw">if</span> (v1 &lt;= v2) {</span>
<span class="line" id="L465">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L466">            <span class="tok-str">&quot;'{}' is not greater than '{}'&quot;</span>,</span>
<span class="line" id="L467">            .{ v1, v2 },</span>
<span class="line" id="L468">        );</span>
<span class="line" id="L469">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L470"></span>
<span class="line" id="L471">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L472">    }</span>
<span class="line" id="L473">}</span>
<span class="line" id="L474"></span>
<span class="line" id="L475"><span class="tok-comment">/// Asserts that the first value is greater than or equal to the second.</span></span>
<span class="line" id="L476"><span class="tok-comment">///</span></span>
<span class="line" id="L477"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L478"><span class="tok-comment">/// try require.isGreaterOrEqual(1, 1);</span></span>
<span class="line" id="L479"><span class="tok-comment">/// try require.isGreaterOrEqual(1.0, 1.0);</span></span>
<span class="line" id="L480"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L481"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isGreaterOrEqual</span>(v1: <span class="tok-kw">anytype</span>, v2: <span class="tok-builtin">@TypeOf</span>(v1)) !<span class="tok-type">void</span> {</span>
<span class="line" id="L482">    <span class="tok-kw">try</span> isGreaterOrEqualf(v1, v2, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L483">}</span>
<span class="line" id="L484"></span>
<span class="line" id="L485"><span class="tok-comment">/// Asserts that the first value is greater than or equal to the second.</span></span>
<span class="line" id="L486"><span class="tok-comment">///</span></span>
<span class="line" id="L487"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L488"><span class="tok-comment">/// try require.isGreaterOrEqualf(1, 1, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L489"><span class="tok-comment">/// try require.isGreaterOrEqualf(1.0, 1.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L490"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L491"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isGreaterOrEqualf</span>(</span>
<span class="line" id="L492">    v1: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L493">    v2: <span class="tok-builtin">@TypeOf</span>(v1),</span>
<span class="line" id="L494">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L495">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L496">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L497">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L498">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(v1));</span>
<span class="line" id="L499"></span>
<span class="line" id="L500">    <span class="tok-kw">if</span> (v1 &lt; v2) {</span>
<span class="line" id="L501">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L502">            <span class="tok-str">&quot;'{}' is not greater than or equal to '{}'&quot;</span>,</span>
<span class="line" id="L503">            .{ v1, v2 },</span>
<span class="line" id="L504">        );</span>
<span class="line" id="L505">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L506"></span>
<span class="line" id="L507">        <span class="tok-kw">try</span> failf(fail_msg.items, msg, args);</span>
<span class="line" id="L508">    }</span>
<span class="line" id="L509">}</span>
<span class="line" id="L510"></span>
<span class="line" id="L511"><span class="tok-comment">/// Asserts that the first value is less than the second.</span></span>
<span class="line" id="L512"><span class="tok-comment">///</span></span>
<span class="line" id="L513"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L514"><span class="tok-comment">/// try require.isLess(1, 2);</span></span>
<span class="line" id="L515"><span class="tok-comment">/// try require.isLess(1.0, 2.0);</span></span>
<span class="line" id="L516"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L517"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLess</span>(v1: <span class="tok-kw">anytype</span>, v2: <span class="tok-builtin">@TypeOf</span>(v1)) !<span class="tok-type">void</span> {</span>
<span class="line" id="L518">    <span class="tok-kw">try</span> isLessf(v1, v2, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L519">}</span>
<span class="line" id="L520"></span>
<span class="line" id="L521"><span class="tok-comment">/// Asserts that the first value is less than the second.</span></span>
<span class="line" id="L522"><span class="tok-comment">///</span></span>
<span class="line" id="L523"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L524"><span class="tok-comment">/// try require.isLessf(1, 2, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L525"><span class="tok-comment">/// try require.isLessf(1.0, 2.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L526"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L527"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLessf</span>(</span>
<span class="line" id="L528">    v1: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L529">    v2: <span class="tok-builtin">@TypeOf</span>(v1),</span>
<span class="line" id="L530">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L531">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L532">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L533">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L534">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(v1));</span>
<span class="line" id="L535"></span>
<span class="line" id="L536">    <span class="tok-kw">if</span> (v1 &gt;= v2) {</span>
<span class="line" id="L537">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L538">            <span class="tok-str">&quot;'{}' is not less than '{}'&quot;</span>,</span>
<span class="line" id="L539">            .{ v1, v2 },</span>
<span class="line" id="L540">        );</span>
<span class="line" id="L541">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L542"></span>
<span class="line" id="L543">        <span class="tok-kw">try</span> failf(fail_msg.items, msg, args);</span>
<span class="line" id="L544">    }</span>
<span class="line" id="L545">}</span>
<span class="line" id="L546"></span>
<span class="line" id="L547"><span class="tok-comment">/// Asserts that the first value is less than or equal to the second.</span></span>
<span class="line" id="L548"><span class="tok-comment">///</span></span>
<span class="line" id="L549"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L550"><span class="tok-comment">/// try require.isLessOrEqual(1, 1);</span></span>
<span class="line" id="L551"><span class="tok-comment">/// try require.isLessOrEqual(1.0, 1.0);</span></span>
<span class="line" id="L552"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L553"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLessOrEqual</span>(v1: <span class="tok-kw">anytype</span>, v2: <span class="tok-builtin">@TypeOf</span>(v1)) !<span class="tok-type">void</span> {</span>
<span class="line" id="L554">    <span class="tok-kw">try</span> isLessOrEqualf(v1, v2, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L555">}</span>
<span class="line" id="L556"></span>
<span class="line" id="L557"><span class="tok-comment">/// Asserts that the first value is less than or equal to the second.</span></span>
<span class="line" id="L558"><span class="tok-comment">///</span></span>
<span class="line" id="L559"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L560"><span class="tok-comment">/// try require.isLessOrEqualf(1, 1, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L561"><span class="tok-comment">/// try require.isLessOrEqualf(1.0, 1.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L562"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L563"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLessOrEqualf</span>(</span>
<span class="line" id="L564">    v1: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L565">    v2: <span class="tok-builtin">@TypeOf</span>(v1),</span>
<span class="line" id="L566">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L567">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L568">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L569">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L570">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(v1));</span>
<span class="line" id="L571"></span>
<span class="line" id="L572">    <span class="tok-kw">if</span> (v1 &gt; v2) {</span>
<span class="line" id="L573">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L574">            <span class="tok-str">&quot;'{}' is not less than or equal to '{}'&quot;</span>,</span>
<span class="line" id="L575">            .{ v1, v2 },</span>
<span class="line" id="L576">        );</span>
<span class="line" id="L577">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L578"></span>
<span class="line" id="L579">        <span class="tok-kw">try</span> failf(fail_msg.items, msg, args);</span>
<span class="line" id="L580">    }</span>
<span class="line" id="L581">}</span>
<span class="line" id="L582"></span>
<span class="line" id="L583"><span class="tok-comment">/// Asserts that the specified value is negative.</span></span>
<span class="line" id="L584"><span class="tok-comment">///</span></span>
<span class="line" id="L585"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L586"><span class="tok-comment">/// try require.isNegative(-1);</span></span>
<span class="line" id="L587"><span class="tok-comment">/// try require.isNegative(-1.0);</span></span>
<span class="line" id="L588"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L589"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isNegative</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L590">    <span class="tok-kw">try</span> isNegativef(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L591">}</span>
<span class="line" id="L592"></span>
<span class="line" id="L593"><span class="tok-comment">/// Asserts that the specified value is negative.</span></span>
<span class="line" id="L594"><span class="tok-comment">///</span></span>
<span class="line" id="L595"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L596"><span class="tok-comment">/// try require.isNegativef(-1, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L597"><span class="tok-comment">/// try require.isNegativef(-1.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L598"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L599"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isNegativef</span>(</span>
<span class="line" id="L600">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L601">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L602">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L603">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L604">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L605">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(value));</span>
<span class="line" id="L606"></span>
<span class="line" id="L607">    <span class="tok-kw">if</span> (value &lt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L608">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(<span class="tok-str">&quot;'{}' is not negative&quot;</span>, .{value});</span>
<span class="line" id="L609">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L610"></span>
<span class="line" id="L611">        <span class="tok-kw">try</span> failf(fail_msg.items, msg, args);</span>
<span class="line" id="L612">    }</span>
<span class="line" id="L613">}</span>
<span class="line" id="L614"></span>
<span class="line" id="L615"><span class="tok-comment">/// Asserts that the specified value is null.</span></span>
<span class="line" id="L616"><span class="tok-comment">///</span></span>
<span class="line" id="L617"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L618"><span class="tok-comment">/// try require.isNull(null);</span></span>
<span class="line" id="L619"><span class="tok-comment">/// try require.isNull(@as(?bool, null));</span></span>
<span class="line" id="L620"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L621"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isNull</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L622">    <span class="tok-kw">try</span> isNullf(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L623">}</span>
<span class="line" id="L624"></span>
<span class="line" id="L625"><span class="tok-comment">/// Asserts that the specified value is null.</span></span>
<span class="line" id="L626"><span class="tok-comment">///</span></span>
<span class="line" id="L627"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L628"><span class="tok-comment">/// try require.isNullf(null, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L629"><span class="tok-comment">/// try require.isNullf(@as(?bool, null), &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L630"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L631"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isNullf</span>(</span>
<span class="line" id="L632">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L633">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L634">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L635">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L636">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L637"></span>
<span class="line" id="L638">    <span class="tok-kw">const</span> info = <span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(value));</span>
<span class="line" id="L639"></span>
<span class="line" id="L640">    <span class="tok-kw">if</span> (info == .Null <span class="tok-kw">or</span> (info == .Optional <span class="tok-kw">and</span> value == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L641">        <span class="tok-kw">return</span>;</span>
<span class="line" id="L642">    }</span>
<span class="line" id="L643"></span>
<span class="line" id="L644">    <span class="tok-kw">const</span> f = <span class="tok-str">&quot;Expected null value, found '{any}'&quot;</span>;</span>
<span class="line" id="L645">    <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> <span class="tok-kw">switch</span> (info) {</span>
<span class="line" id="L646">        .Optional =&gt; sprintf(f, .{value.?}),</span>
<span class="line" id="L647">        <span class="tok-kw">else</span> =&gt; sprintf(f, .{value}),</span>
<span class="line" id="L648">    };</span>
<span class="line" id="L649">    <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L650"></span>
<span class="line" id="L651">    <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L652">}</span>
<span class="line" id="L653"></span>
<span class="line" id="L654"><span class="tok-comment">/// Asserts that the specified value is positive.</span></span>
<span class="line" id="L655"><span class="tok-comment">///</span></span>
<span class="line" id="L656"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L657"><span class="tok-comment">/// try require.isPositive(1);</span></span>
<span class="line" id="L658"><span class="tok-comment">/// try require.isPositive(1.0);</span></span>
<span class="line" id="L659"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L660"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isPositive</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L661">    <span class="tok-kw">try</span> isPositivef(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L662">}</span>
<span class="line" id="L663"></span>
<span class="line" id="L664"><span class="tok-comment">/// Asserts that the specified value is positive.</span></span>
<span class="line" id="L665"><span class="tok-comment">///</span></span>
<span class="line" id="L666"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L667"><span class="tok-comment">/// try require.isPositivef(1, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L668"><span class="tok-comment">/// try require.isPositivef(1.0, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L669"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L670"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isPositivef</span>(</span>
<span class="line" id="L671">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L672">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L673">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L674">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L675">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L676">    <span class="tok-kw">comptime</span> checkComparable(<span class="tok-builtin">@TypeOf</span>(value));</span>
<span class="line" id="L677"></span>
<span class="line" id="L678">    <span class="tok-kw">if</span> (value &gt;= <span class="tok-number">0</span>) {</span>
<span class="line" id="L679">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(<span class="tok-str">&quot;'{}' is not positive&quot;</span>, .{value});</span>
<span class="line" id="L680">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L681"></span>
<span class="line" id="L682">        <span class="tok-kw">try</span> failf(fail_msg.items, msg, args);</span>
<span class="line" id="L683">    }</span>
<span class="line" id="L684">}</span>
<span class="line" id="L685"></span>
<span class="line" id="L686"><span class="tok-comment">/// Asserts that the specified value is true.</span></span>
<span class="line" id="L687"><span class="tok-comment">///</span></span>
<span class="line" id="L688"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L689"><span class="tok-comment">/// try require.isTrue(true);</span></span>
<span class="line" id="L690"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L691"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isTrue</span>(value: <span class="tok-type">bool</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L692">    <span class="tok-kw">try</span> isTruef(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L693">}</span>
<span class="line" id="L694"></span>
<span class="line" id="L695"><span class="tok-comment">/// Asserts that the specified value is true.</span></span>
<span class="line" id="L696"><span class="tok-comment">///</span></span>
<span class="line" id="L697"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L698"><span class="tok-comment">/// try require.isTruef(true, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L699"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L700"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">isTruef</span>(</span>
<span class="line" id="L701">    value: <span class="tok-type">bool</span>,</span>
<span class="line" id="L702">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L703">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L704">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L705">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L706"></span>
<span class="line" id="L707">    <span class="tok-kw">if</span> (!value) {</span>
<span class="line" id="L708">        <span class="tok-kw">try</span> failf(<span class="tok-str">&quot;Should be true&quot;</span>, msg, args);</span>
<span class="line" id="L709">    }</span>
<span class="line" id="L710">}</span>
<span class="line" id="L711"></span>
<span class="line" id="L712"><span class="tok-comment">/// Asserts that the specified list has a specific length.</span></span>
<span class="line" id="L713"><span class="tok-comment">///</span></span>
<span class="line" id="L714"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L715"><span class="tok-comment">/// try require.len(.{ 1, 2, 3 }, 3);</span></span>
<span class="line" id="L716"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L717"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">len</span>(list: <span class="tok-kw">anytype</span>, length: <span class="tok-type">usize</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L718">    <span class="tok-kw">try</span> lenf(list, length, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L719">}</span>
<span class="line" id="L720"></span>
<span class="line" id="L721"><span class="tok-comment">/// Asserts that the specified list has a specific length.</span></span>
<span class="line" id="L722"><span class="tok-comment">///</span></span>
<span class="line" id="L723"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L724"><span class="tok-comment">/// try require.lenf(.{ 1, 2, 3 }, 3, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L725"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L726"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">lenf</span>(</span>
<span class="line" id="L727">    list: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L728">    length: <span class="tok-type">usize</span>,</span>
<span class="line" id="L729">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L730">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L731">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L732">    <span class="tok-kw">const</span> List = <span class="tok-builtin">@TypeOf</span>(list);</span>
<span class="line" id="L733"></span>
<span class="line" id="L734">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L735">        <span class="tok-kw">if</span> (!isList(List)) {</span>
<span class="line" id="L736">            <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L737">                <span class="tok-str">&quot;expected 'list' to be a list, found '{s}'&quot;</span>,</span>
<span class="line" id="L738">                .{<span class="tok-builtin">@typeName</span>(List)},</span>
<span class="line" id="L739">            );</span>
<span class="line" id="L740">            <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L741">        }</span>
<span class="line" id="L742"></span>
<span class="line" id="L743">        checkArgs(args);</span>
<span class="line" id="L744">    }</span>
<span class="line" id="L745"></span>
<span class="line" id="L746">    <span class="tok-kw">const</span> list_len: <span class="tok-type">usize</span> = <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(List)) {</span>
<span class="line" id="L747">        <span class="tok-kw">inline</span> .Array, .Struct =&gt; list.len,</span>
<span class="line" id="L748">        .Pointer =&gt; |info| <span class="tok-kw">if</span> (info.size == .Slice) list.len <span class="tok-kw">else</span> list.*.len,</span>
<span class="line" id="L749">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L750">    };</span>
<span class="line" id="L751"></span>
<span class="line" id="L752">    <span class="tok-kw">if</span> (list_len != length) {</span>
<span class="line" id="L753">        <span class="tok-kw">const</span> f = <span class="tok-kw">comptime</span> f: {</span>
<span class="line" id="L754">            <span class="tok-kw">if</span> (isString(List)) {</span>
<span class="line" id="L755">                <span class="tok-kw">break</span> :f <span class="tok-str">&quot;\&quot;{s}\&quot; should have {} item(s), but has {}&quot;</span>;</span>
<span class="line" id="L756">            }</span>
<span class="line" id="L757">            <span class="tok-kw">break</span> :f <span class="tok-str">&quot;{any} should have {} item(s), but has {}&quot;</span>;</span>
<span class="line" id="L758">        };</span>
<span class="line" id="L759">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(f, .{ list, length, list_len });</span>
<span class="line" id="L760">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L761"></span>
<span class="line" id="L762">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L763">    }</span>
<span class="line" id="L764">}</span>
<span class="line" id="L765"></span>
<span class="line" id="L766"><span class="tok-comment">/// Asserts that the specified string, array, slice, or tuple does not contain</span></span>
<span class="line" id="L767"><span class="tok-comment">/// the specified substring or element.</span></span>
<span class="line" id="L768"><span class="tok-comment">///</span></span>
<span class="line" id="L769"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L770"><span class="tok-comment">/// try require.notContainsf(&quot;Hello World&quot;, 'E');</span></span>
<span class="line" id="L771"><span class="tok-comment">/// try require.notContainsf(&quot;Hello World&quot;, &quot;Earth&quot;);</span></span>
<span class="line" id="L772"><span class="tok-comment">/// try require.notContainsf(.{ &quot;Hello&quot;, &quot;World&quot; }, &quot;Earth&quot;);</span></span>
<span class="line" id="L773"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L774"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notContains</span>(haystack: <span class="tok-kw">anytype</span>, needle: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L775">    <span class="tok-kw">try</span> notContainsf(haystack, needle, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L776">}</span>
<span class="line" id="L777"></span>
<span class="line" id="L778"><span class="tok-comment">/// Asserts that the specified string, array, slice, or tuple does not contain</span></span>
<span class="line" id="L779"><span class="tok-comment">/// the specified substring or element.</span></span>
<span class="line" id="L780"><span class="tok-comment">///</span></span>
<span class="line" id="L781"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L782"><span class="tok-comment">/// try require.notContainsf(&quot;Hello World&quot;, 'E', &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L783"><span class="tok-comment">/// try require.notContainsf(&quot;Hello World&quot;, &quot;Earth&quot;, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L784"><span class="tok-comment">/// try require.notContainsf(.{ &quot;Hello&quot;, &quot;World&quot; }, &quot;Earth&quot;, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L785"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L786"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notContainsf</span>(</span>
<span class="line" id="L787">    haystack: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L788">    needle: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L789">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L790">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L791">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L792">    <span class="tok-kw">const</span> Haystack = <span class="tok-builtin">@TypeOf</span>(haystack);</span>
<span class="line" id="L793">    <span class="tok-kw">const</span> Needle = <span class="tok-builtin">@TypeOf</span>(needle);</span>
<span class="line" id="L794"></span>
<span class="line" id="L795">    <span class="tok-kw">if</span> (containsElement(haystack, needle)) {</span>
<span class="line" id="L796">        <span class="tok-kw">const</span> f = <span class="tok-kw">comptime</span> f: {</span>
<span class="line" id="L797">            <span class="tok-kw">const</span> haystack_is_str = isString(Haystack);</span>
<span class="line" id="L798">            <span class="tok-kw">const</span> needle_is_str = isString(Needle);</span>
<span class="line" id="L799"></span>
<span class="line" id="L800">            <span class="tok-kw">if</span> (haystack_is_str <span class="tok-kw">and</span> needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L801">            <span class="tok-str">\\&quot;{s}&quot; should not contain &quot;{s}&quot;</span></span>

<span class="line" id="L802">            ;</span>
<span class="line" id="L803">            <span class="tok-kw">if</span> (!haystack_is_str <span class="tok-kw">and</span> !needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L804">            <span class="tok-str">\\{any} should not contain {any}</span></span>

<span class="line" id="L805">            ;</span>
<span class="line" id="L806">            <span class="tok-kw">if</span> (haystack_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L807">            <span class="tok-str">\\&quot;{s}&quot; should not contain &quot;{u}&quot;</span></span>

<span class="line" id="L808">            ;</span>
<span class="line" id="L809">            <span class="tok-kw">if</span> (needle_is_str) <span class="tok-kw">break</span> :f </span>
<span class="line" id="L810">            <span class="tok-str">\\{any} should not contain &quot;{s}&quot;</span></span>

<span class="line" id="L811">            ;</span>
<span class="line" id="L812">        };</span>
<span class="line" id="L813">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(f, .{ haystack, needle });</span>
<span class="line" id="L814">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L815"></span>
<span class="line" id="L816">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L817">    }</span>
<span class="line" id="L818">}</span>
<span class="line" id="L819"></span>
<span class="line" id="L820"><span class="tok-comment">/// Asserts that a value is not an error.</span></span>
<span class="line" id="L821"><span class="tok-comment">///</span></span>
<span class="line" id="L822"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L823"><span class="tok-comment">/// try require.notError(true);</span></span>
<span class="line" id="L824"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L825"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notError</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L826">    <span class="tok-kw">try</span> notErrorf(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L827">}</span>
<span class="line" id="L828"></span>
<span class="line" id="L829"><span class="tok-comment">/// Asserts that a value is not an error.</span></span>
<span class="line" id="L830"><span class="tok-comment">///</span></span>
<span class="line" id="L831"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L832"><span class="tok-comment">/// try require.notErrorf(true, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L833"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L834"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notErrorf</span>(</span>
<span class="line" id="L835">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L836">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L837">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L838">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L839">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L840"></span>
<span class="line" id="L841">    <span class="tok-kw">if</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(value)) == .ErrorSet) {</span>
<span class="line" id="L842">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(</span>
<span class="line" id="L843">            <span class="tok-str">&quot;Expected non-error, found '{}'&quot;</span>,</span>
<span class="line" id="L844">            .{value},</span>
<span class="line" id="L845">        );</span>
<span class="line" id="L846">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L847"></span>
<span class="line" id="L848">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L849">    }</span>
<span class="line" id="L850">}</span>
<span class="line" id="L851"></span>
<span class="line" id="L852"><span class="tok-comment">/// Asserts that two values are not equal.</span></span>
<span class="line" id="L853"><span class="tok-comment">///</span></span>
<span class="line" id="L854"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L855"><span class="tok-comment">/// try require.notEqual(123, 456);</span></span>
<span class="line" id="L856"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L857"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notEqual</span>(expected: <span class="tok-kw">anytype</span>, value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L858">    <span class="tok-kw">try</span> notEqualf(expected, value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L859">}</span>
<span class="line" id="L860"></span>
<span class="line" id="L861"><span class="tok-comment">/// Asserts that two values are not equal.</span></span>
<span class="line" id="L862"><span class="tok-comment">///</span></span>
<span class="line" id="L863"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L864"><span class="tok-comment">/// try require.notEqualf(123, 456, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L865"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L866"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notEqualf</span>(</span>
<span class="line" id="L867">    expected: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L868">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L869">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L870">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L871">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L872">    <span class="tok-kw">const</span> Value = <span class="tok-builtin">@TypeOf</span>(value);</span>
<span class="line" id="L873"></span>
<span class="line" id="L874">    <span class="tok-kw">if</span> (deepEqual(expected, value)) {</span>
<span class="line" id="L875">        <span class="tok-kw">const</span> f = <span class="tok-kw">comptime</span> f: {</span>
<span class="line" id="L876">            <span class="tok-kw">if</span> (isString(Value)) {</span>
<span class="line" id="L877">                <span class="tok-kw">break</span> :f <span class="tok-str">&quot;Should not be: {s}&quot;</span>;</span>
<span class="line" id="L878">            }</span>
<span class="line" id="L879"></span>
<span class="line" id="L880">            <span class="tok-kw">break</span> :f <span class="tok-str">&quot;Should not be: {any}&quot;</span>;</span>
<span class="line" id="L881">        };</span>
<span class="line" id="L882">        <span class="tok-kw">const</span> fail_msg = <span class="tok-kw">try</span> sprintf(f, .{value});</span>
<span class="line" id="L883">        <span class="tok-kw">defer</span> test_ally.free(fail_msg);</span>
<span class="line" id="L884"></span>
<span class="line" id="L885">        <span class="tok-kw">try</span> failf(fail_msg, msg, args);</span>
<span class="line" id="L886">    }</span>
<span class="line" id="L887">}</span>
<span class="line" id="L888"></span>
<span class="line" id="L889"><span class="tok-comment">/// Asserts that the specified value is not null.</span></span>
<span class="line" id="L890"><span class="tok-comment">///</span></span>
<span class="line" id="L891"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L892"><span class="tok-comment">/// try require.notNull(true);</span></span>
<span class="line" id="L893"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L894"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notNull</span>(value: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L895">    <span class="tok-kw">try</span> notNullf(value, <span class="tok-str">&quot;&quot;</span>, .{});</span>
<span class="line" id="L896">}</span>
<span class="line" id="L897"></span>
<span class="line" id="L898"><span class="tok-comment">/// Asserts that the specified value is not null.</span></span>
<span class="line" id="L899"><span class="tok-comment">///</span></span>
<span class="line" id="L900"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L901"><span class="tok-comment">/// try require.notNullf(true, &quot;error message {s}&quot;, .{&quot;formatted&quot;});</span></span>
<span class="line" id="L902"><span class="tok-comment">/// ```</span></span>
<span class="line" id="L903"><span class="tok-kw">pub</span> <span class="tok-kw">inline</span> <span class="tok-kw">fn</span> <span class="tok-fn">notNullf</span>(</span>
<span class="line" id="L904">    value: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L905">    <span class="tok-kw">comptime</span> msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L906">    args: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L907">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L908">    <span class="tok-kw">comptime</span> checkArgs(args);</span>
<span class="line" id="L909"></span>
<span class="line" id="L910">    <span class="tok-kw">const</span> info = <span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(value));</span>
<span class="line" id="L911"></span>
<span class="line" id="L912">    <span class="tok-kw">if</span> (info == .Null <span class="tok-kw">or</span> (info == .Optional <span class="tok-kw">and</span> value == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L913">        <span class="tok-kw">try</span> failf(<span class="tok-str">&quot;Received unexpected null value&quot;</span>, msg, args);</span>
<span class="line" id="L914">    }</span>
<span class="line" id="L915">}</span>
<span class="line" id="L916"></span>
<span class="line" id="L917"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L918"><span class="tok-comment">// Validation</span>
</span>
<span class="line" id="L919"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L920"></span>
<span class="line" id="L921"><span class="tok-kw">fn</span> <span class="tok-fn">checkArgs</span>(args: <span class="tok-kw">anytype</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L922">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L923">        <span class="tok-kw">const</span> T = <span class="tok-builtin">@TypeOf</span>(args);</span>
<span class="line" id="L924">        <span class="tok-kw">const</span> info = <span class="tok-builtin">@typeInfo</span>(T);</span>
<span class="line" id="L925"></span>
<span class="line" id="L926">        <span class="tok-kw">if</span> (info != .Struct <span class="tok-kw">or</span> !info.Struct.is_tuple) {</span>
<span class="line" id="L927">            <span class="tok-builtin">@compileError</span>(fmt.comptimePrint(</span>
<span class="line" id="L928">                <span class="tok-str">&quot;expected 'args' to be a tuple, found '{s}'&quot;</span>,</span>
<span class="line" id="L929">                .{<span class="tok-builtin">@typeName</span>(T)},</span>
<span class="line" id="L930">            ));</span>
<span class="line" id="L931">        }</span>
<span class="line" id="L932">    }</span>
<span class="line" id="L933">}</span>
<span class="line" id="L934"></span>
<span class="line" id="L935"><span class="tok-kw">fn</span> <span class="tok-fn">checkComparable</span>(<span class="tok-kw">comptime</span> T: <span class="tok-type">type</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L936">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L937">        <span class="tok-kw">const</span> info = <span class="tok-builtin">@typeInfo</span>(T);</span>
<span class="line" id="L938"></span>
<span class="line" id="L939">        <span class="tok-kw">const</span> is_int = info == .Int <span class="tok-kw">or</span> info == .ComptimeInt;</span>
<span class="line" id="L940">        <span class="tok-kw">const</span> is_float = info == .Float <span class="tok-kw">or</span> info == .ComptimeFloat;</span>
<span class="line" id="L941">        <span class="tok-kw">if</span> (!is_int <span class="tok-kw">and</span> !is_float) {</span>
<span class="line" id="L942">            <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L943">                <span class="tok-str">&quot;expected integer or float, found '{s}'&quot;</span>,</span>
<span class="line" id="L944">                .{<span class="tok-builtin">@typeName</span>(T)},</span>
<span class="line" id="L945">            );</span>
<span class="line" id="L946">            <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L947">        }</span>
<span class="line" id="L948">    }</span>
<span class="line" id="L949">}</span>
<span class="line" id="L950"></span>
<span class="line" id="L951"><span class="tok-kw">fn</span> <span class="tok-fn">isEmpty</span>(list: <span class="tok-kw">anytype</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L952">    assert(isList(<span class="tok-builtin">@TypeOf</span>(list)));</span>
<span class="line" id="L953"></span>
<span class="line" id="L954">    <span class="tok-kw">return</span> <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(list))) {</span>
<span class="line" id="L955">        .Pointer =&gt; |info| <span class="tok-kw">if</span> (info.size == .One) list.*.len == <span class="tok-number">0</span>,</span>
<span class="line" id="L956">        <span class="tok-kw">else</span> =&gt; list.len == <span class="tok-number">0</span>,</span>
<span class="line" id="L957">    };</span>
<span class="line" id="L958">}</span>
<span class="line" id="L959"></span>
<span class="line" id="L960"><span class="tok-kw">fn</span> <span class="tok-fn">isList</span>(<span class="tok-kw">comptime</span> List: <span class="tok-type">type</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L961">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L962">        <span class="tok-kw">return</span> <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(List)) {</span>
<span class="line" id="L963">            .Array =&gt; <span class="tok-null">true</span>,</span>
<span class="line" id="L964">            .Pointer =&gt; |info| ret: {</span>
<span class="line" id="L965">                <span class="tok-kw">const</span> is_slice = info.size == .Slice;</span>
<span class="line" id="L966">                <span class="tok-kw">const</span> is_ptr_to_array = info.size == .One <span class="tok-kw">and</span> <span class="tok-builtin">@typeInfo</span>(meta.Child(List)) == .Array;</span>
<span class="line" id="L967">                <span class="tok-kw">break</span> :ret is_slice <span class="tok-kw">or</span> is_ptr_to_array;</span>
<span class="line" id="L968">            },</span>
<span class="line" id="L969">            .Struct =&gt; |info| info.is_tuple,</span>
<span class="line" id="L970">            <span class="tok-kw">else</span> =&gt; <span class="tok-null">false</span>,</span>
<span class="line" id="L971">        };</span>
<span class="line" id="L972">    }</span>
<span class="line" id="L973">}</span>
<span class="line" id="L974"></span>
<span class="line" id="L975"><span class="tok-kw">fn</span> <span class="tok-fn">isString</span>(<span class="tok-kw">comptime</span> T: <span class="tok-type">type</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L976">    <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L977">        <span class="tok-comment">// Only pointer types can be strings, no optionals</span>
</span>
<span class="line" id="L978">        <span class="tok-kw">const</span> info = <span class="tok-builtin">@typeInfo</span>(T);</span>
<span class="line" id="L979">        <span class="tok-kw">if</span> (info != .Pointer) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L980">        <span class="tok-kw">const</span> ptr = &amp;info.Pointer;</span>
<span class="line" id="L981"></span>
<span class="line" id="L982">        <span class="tok-comment">// Check for CV qualifiers that would prevent coerction to []const u8</span>
</span>
<span class="line" id="L983">        <span class="tok-kw">if</span> (ptr.is_volatile <span class="tok-kw">or</span> ptr.is_allowzero) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L984"></span>
<span class="line" id="L985">        <span class="tok-comment">// If it's already a slice, simple check.</span>
</span>
<span class="line" id="L986">        <span class="tok-kw">if</span> (ptr.size == .Slice) {</span>
<span class="line" id="L987">            <span class="tok-kw">return</span> ptr.child == <span class="tok-type">u8</span>;</span>
<span class="line" id="L988">        }</span>
<span class="line" id="L989"></span>
<span class="line" id="L990">        <span class="tok-comment">// Otherwise check if it's an array type that coerces to slice.</span>
</span>
<span class="line" id="L991">        <span class="tok-kw">if</span> (ptr.size == .One) {</span>
<span class="line" id="L992">            <span class="tok-kw">const</span> child = <span class="tok-builtin">@typeInfo</span>(ptr.child);</span>
<span class="line" id="L993">            <span class="tok-kw">if</span> (child == .Array) {</span>
<span class="line" id="L994">                <span class="tok-kw">const</span> arr = &amp;child.Array;</span>
<span class="line" id="L995">                <span class="tok-kw">return</span> arr.child == <span class="tok-type">u8</span>;</span>
<span class="line" id="L996">            }</span>
<span class="line" id="L997">        }</span>
<span class="line" id="L998"></span>
<span class="line" id="L999">        <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1000">    }</span>
<span class="line" id="L1001">}</span>
<span class="line" id="L1002"></span>
<span class="line" id="L1003"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L1004"><span class="tok-comment">// Formatting</span>
</span>
<span class="line" id="L1005"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L1006"></span>
<span class="line" id="L1007"><span class="tok-kw">fn</span> <span class="tok-fn">sprintf</span>(<span class="tok-kw">comptime</span> f: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>, args: <span class="tok-kw">anytype</span>) ![]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1008">    <span class="tok-kw">var</span> msg = ArrayList(<span class="tok-type">u8</span>).init(test_ally);</span>
<span class="line" id="L1009">    <span class="tok-kw">errdefer</span> msg.deinit();</span>
<span class="line" id="L1010"></span>
<span class="line" id="L1011">    <span class="tok-kw">try</span> fmt.format(msg.writer(), f, args);</span>
<span class="line" id="L1012"></span>
<span class="line" id="L1013">    <span class="tok-kw">return</span> msg.toOwnedSlice();</span>
<span class="line" id="L1014">}</span>
<span class="line" id="L1015"></span>
<span class="line" id="L1016"><span class="tok-kw">fn</span> <span class="tok-fn">formatDiffList</span>(</span>
<span class="line" id="L1017">    listA: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L1018">    listB: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L1019">    extraA: []<span class="tok-type">usize</span>,</span>
<span class="line" id="L1020">    extraB: []<span class="tok-type">usize</span>,</span>
<span class="line" id="L1021">) ![]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1022">    <span class="tok-kw">var</span> fail_msg = ArrayList(<span class="tok-type">u8</span>).init(test_ally);</span>
<span class="line" id="L1023">    <span class="tok-kw">const</span> fail_msg_writer = fail_msg.writer();</span>
<span class="line" id="L1024">    <span class="tok-kw">errdefer</span> fail_msg.deinit();</span>
<span class="line" id="L1025"></span>
<span class="line" id="L1026">    <span class="tok-kw">try</span> fmt.format(fail_msg_writer, <span class="tok-str">&quot;elements differ&quot;</span>, .{});</span>
<span class="line" id="L1027"></span>
<span class="line" id="L1028">    <span class="tok-kw">try</span> formatExtra(fail_msg_writer, extraA, <span class="tok-str">'A'</span>, listA);</span>
<span class="line" id="L1029">    <span class="tok-kw">try</span> formatExtra(fail_msg_writer, extraB, <span class="tok-str">'B'</span>, listB);</span>
<span class="line" id="L1030"></span>
<span class="line" id="L1031">    <span class="tok-kw">try</span> fmt.format(fail_msg_writer, <span class="tok-str">&quot;\n\nlistA:\n&quot;</span>, .{});</span>
<span class="line" id="L1032">    <span class="tok-kw">try</span> formatList(fail_msg_writer, listA);</span>
<span class="line" id="L1033">    <span class="tok-kw">try</span> fmt.format(fail_msg_writer, <span class="tok-str">&quot;\n\nlistB:\n&quot;</span>, .{});</span>
<span class="line" id="L1034">    <span class="tok-kw">try</span> formatList(fail_msg_writer, listB);</span>
<span class="line" id="L1035">    <span class="tok-kw">try</span> fmt.format(fail_msg_writer, <span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L1036"></span>
<span class="line" id="L1037">    <span class="tok-kw">return</span> <span class="tok-kw">try</span> fail_msg.toOwnedSlice();</span>
<span class="line" id="L1038">}</span>
<span class="line" id="L1039"></span>
<span class="line" id="L1040"><span class="tok-kw">fn</span> <span class="tok-fn">formatExtra</span>(</span>
<span class="line" id="L1041">    writer: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L1042">    extra: []<span class="tok-type">usize</span>,</span>
<span class="line" id="L1043">    <span class="tok-kw">comptime</span> letter: <span class="tok-type">comptime_int</span>,</span>
<span class="line" id="L1044">    list: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L1045">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L1046">    assert(isList(<span class="tok-builtin">@TypeOf</span>(list)));</span>
<span class="line" id="L1047"></span>
<span class="line" id="L1048">    <span class="tok-kw">if</span> (extra.len == <span class="tok-number">0</span>) {</span>
<span class="line" id="L1049">        <span class="tok-kw">return</span>;</span>
<span class="line" id="L1050">    }</span>
<span class="line" id="L1051"></span>
<span class="line" id="L1052">    <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;\n\nextra elements in list {u}:\n&quot;</span>, .{letter});</span>
<span class="line" id="L1053">    <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{{ &quot;</span>, .{});</span>
<span class="line" id="L1054"></span>
<span class="line" id="L1055">    <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(list))) {</span>
<span class="line" id="L1056">        .Struct =&gt; <span class="tok-kw">for</span> (extra, <span class="tok-number">0</span>..) |idx, i| {</span>
<span class="line" id="L1057">            <span class="tok-kw">if</span> (i != extra.len - <span class="tok-number">1</span>) {</span>
<span class="line" id="L1058">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (list, <span class="tok-number">0</span>..) |elemA, j| {</span>
<span class="line" id="L1059">                    <span class="tok-kw">if</span> (j == idx) {</span>
<span class="line" id="L1060">                        <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}, &quot;</span>, .{elemA});</span>
<span class="line" id="L1061">                    }</span>
<span class="line" id="L1062">                }</span>
<span class="line" id="L1063">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1064">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (list, <span class="tok-number">0</span>..) |elemA, j| {</span>
<span class="line" id="L1065">                    <span class="tok-kw">if</span> (j == idx) {</span>
<span class="line" id="L1066">                        <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}&quot;</span>, .{elemA});</span>
<span class="line" id="L1067">                    }</span>
<span class="line" id="L1068">                }</span>
<span class="line" id="L1069">            }</span>
<span class="line" id="L1070">        },</span>
<span class="line" id="L1071">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">for</span> (extra, <span class="tok-number">0</span>..) |idx, i| {</span>
<span class="line" id="L1072">            <span class="tok-kw">if</span> (i != extra.len - <span class="tok-number">1</span>) {</span>
<span class="line" id="L1073">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}, &quot;</span>, .{list[idx]});</span>
<span class="line" id="L1074">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1075">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}&quot;</span>, .{list[idx]});</span>
<span class="line" id="L1076">            }</span>
<span class="line" id="L1077">        },</span>
<span class="line" id="L1078">    }</span>
<span class="line" id="L1079"></span>
<span class="line" id="L1080">    <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot; }}&quot;</span>, .{});</span>
<span class="line" id="L1081">}</span>
<span class="line" id="L1082"></span>
<span class="line" id="L1083"><span class="tok-kw">fn</span> <span class="tok-fn">formatList</span>(writer: <span class="tok-kw">anytype</span>, list: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L1084">    assert(isList(<span class="tok-builtin">@TypeOf</span>(list)));</span>
<span class="line" id="L1085"></span>
<span class="line" id="L1086">    <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{{ &quot;</span>, .{});</span>
<span class="line" id="L1087"></span>
<span class="line" id="L1088">    <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(list))) {</span>
<span class="line" id="L1089">        .Struct =&gt; <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (list, <span class="tok-number">0</span>..) |elem, i| {</span>
<span class="line" id="L1090">            <span class="tok-kw">if</span> (i != list.len - <span class="tok-number">1</span>) {</span>
<span class="line" id="L1091">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}, &quot;</span>, .{elem});</span>
<span class="line" id="L1092">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1093">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}&quot;</span>, .{elem});</span>
<span class="line" id="L1094">            }</span>
<span class="line" id="L1095">        },</span>
<span class="line" id="L1096">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">for</span> (list, <span class="tok-number">0</span>..) |elem, i| {</span>
<span class="line" id="L1097">            <span class="tok-kw">if</span> (i != list.len - <span class="tok-number">1</span>) {</span>
<span class="line" id="L1098">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}, &quot;</span>, .{elem});</span>
<span class="line" id="L1099">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1100">                <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot;{any}&quot;</span>, .{elem});</span>
<span class="line" id="L1101">            }</span>
<span class="line" id="L1102">        },</span>
<span class="line" id="L1103">    }</span>
<span class="line" id="L1104"></span>
<span class="line" id="L1105">    <span class="tok-kw">try</span> fmt.format(writer, <span class="tok-str">&quot; }}&quot;</span>, .{});</span>
<span class="line" id="L1106">}</span>
<span class="line" id="L1107"></span>
<span class="line" id="L1108"><span class="tok-kw">const</span> LabelContent = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L1109">    label: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1110">    content: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1111">};</span>
<span class="line" id="L1112"></span>
<span class="line" id="L1113"><span class="tok-kw">fn</span> <span class="tok-fn">labelOutput</span>(contents: []<span class="tok-kw">const</span> LabelContent) ![]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1114">    <span class="tok-kw">const</span> longest_label_len: <span class="tok-type">usize</span> = longest_label_len: {</span>
<span class="line" id="L1115">        <span class="tok-kw">var</span> longest: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1116">        <span class="tok-kw">for</span> (contents) |v| {</span>
<span class="line" id="L1117">            <span class="tok-kw">if</span> (v.label.len &gt; longest) {</span>
<span class="line" id="L1118">                longest = v.label.len;</span>
<span class="line" id="L1119">            }</span>
<span class="line" id="L1120">        }</span>
<span class="line" id="L1121">        <span class="tok-kw">break</span> :longest_label_len longest;</span>
<span class="line" id="L1122">    };</span>
<span class="line" id="L1123"></span>
<span class="line" id="L1124">    <span class="tok-kw">var</span> output = ArrayList(<span class="tok-type">u8</span>).init(test_ally);</span>
<span class="line" id="L1125">    <span class="tok-kw">errdefer</span> output.deinit();</span>
<span class="line" id="L1126"></span>
<span class="line" id="L1127">    <span class="tok-kw">for</span> (contents) |v| {</span>
<span class="line" id="L1128">        <span class="tok-comment">// Label</span>
</span>
<span class="line" id="L1129">        <span class="tok-kw">try</span> output.append(<span class="tok-str">'\t'</span>);</span>
<span class="line" id="L1130">        <span class="tok-kw">try</span> output.appendSlice(v.label);</span>
<span class="line" id="L1131">        <span class="tok-kw">try</span> output.append(<span class="tok-str">':'</span>);</span>
<span class="line" id="L1132"></span>
<span class="line" id="L1133">        <span class="tok-comment">// Separator</span>
</span>
<span class="line" id="L1134">        <span class="tok-kw">try</span> output.appendNTimes(<span class="tok-str">' '</span>, longest_label_len - v.label.len);</span>
<span class="line" id="L1135"></span>
<span class="line" id="L1136">        <span class="tok-comment">// Content</span>
</span>
<span class="line" id="L1137">        <span class="tok-kw">try</span> output.append(<span class="tok-str">'\t'</span>);</span>
<span class="line" id="L1138">        <span class="tok-kw">const</span> iml = <span class="tok-kw">try</span> indentMessageLines(v.content, longest_label_len);</span>
<span class="line" id="L1139">        <span class="tok-kw">defer</span> test_ally.free(iml);</span>
<span class="line" id="L1140">        <span class="tok-kw">try</span> output.appendSlice(iml);</span>
<span class="line" id="L1141"></span>
<span class="line" id="L1142">        <span class="tok-comment">// Newline</span>
</span>
<span class="line" id="L1143">        <span class="tok-kw">try</span> output.append(<span class="tok-str">'\n'</span>);</span>
<span class="line" id="L1144">    }</span>
<span class="line" id="L1145"></span>
<span class="line" id="L1146">    <span class="tok-kw">return</span> output.toOwnedSlice();</span>
<span class="line" id="L1147">}</span>
<span class="line" id="L1148"></span>
<span class="line" id="L1149"><span class="tok-kw">fn</span> <span class="tok-fn">indentMessageLines</span>(msg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>, longest_label_len: <span class="tok-type">usize</span>) ![]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1150">    <span class="tok-kw">var</span> output = ArrayList(<span class="tok-type">u8</span>).init(test_ally);</span>
<span class="line" id="L1151">    <span class="tok-kw">errdefer</span> output.deinit();</span>
<span class="line" id="L1152"></span>
<span class="line" id="L1153">    <span class="tok-kw">var</span> fbs = io.fixedBufferStream(msg);</span>
<span class="line" id="L1154">    <span class="tok-kw">const</span> fbs_r = fbs.reader();</span>
<span class="line" id="L1155">    <span class="tok-kw">var</span> br = io.bufferedReader(fbs_r);</span>
<span class="line" id="L1156">    <span class="tok-kw">const</span> br_r = br.reader();</span>
<span class="line" id="L1157"></span>
<span class="line" id="L1158">    <span class="tok-kw">var</span> i: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1159">    <span class="tok-kw">while</span> (<span class="tok-kw">try</span> br_r.readUntilDelimiterOrEofAlloc(test_ally, <span class="tok-str">'\n'</span>, <span class="tok-number">10_000</span>)) |buf| : (i += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1160">        <span class="tok-kw">defer</span> test_ally.free(buf);</span>
<span class="line" id="L1161"></span>
<span class="line" id="L1162">        <span class="tok-kw">if</span> (i != <span class="tok-number">0</span>) {</span>
<span class="line" id="L1163">            <span class="tok-kw">try</span> output.appendSlice(&amp;.{ <span class="tok-str">'\n'</span>, <span class="tok-str">'\t'</span> });</span>
<span class="line" id="L1164">            <span class="tok-kw">try</span> output.appendNTimes(<span class="tok-str">' '</span>, longest_label_len + <span class="tok-number">1</span>);</span>
<span class="line" id="L1165">            <span class="tok-kw">try</span> output.append(<span class="tok-str">'\t'</span>);</span>
<span class="line" id="L1166">        }</span>
<span class="line" id="L1167"></span>
<span class="line" id="L1168">        <span class="tok-kw">try</span> output.appendSlice(buf);</span>
<span class="line" id="L1169">    }</span>
<span class="line" id="L1170"></span>
<span class="line" id="L1171">    <span class="tok-kw">return</span> output.toOwnedSlice();</span>
<span class="line" id="L1172">}</span>
<span class="line" id="L1173"></span>
<span class="line" id="L1174"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L1175"><span class="tok-comment">// Comparison</span>
</span>
<span class="line" id="L1176"><span class="tok-comment">////////////////////////////////////////////////////////////////////////////////</span>
</span>
<span class="line" id="L1177"></span>
<span class="line" id="L1178"><span class="tok-kw">fn</span> <span class="tok-fn">containsElement</span>(haystack: <span class="tok-kw">anytype</span>, needle: <span class="tok-kw">anytype</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L1179">    <span class="tok-kw">const</span> Haystack = <span class="tok-builtin">@TypeOf</span>(haystack);</span>
<span class="line" id="L1180">    <span class="tok-kw">const</span> Needle = <span class="tok-builtin">@TypeOf</span>(needle);</span>
<span class="line" id="L1181">    <span class="tok-kw">const</span> haystack_info = <span class="tok-builtin">@typeInfo</span>(Haystack);</span>
<span class="line" id="L1182">    <span class="tok-kw">const</span> haystack_is_str = <span class="tok-kw">comptime</span> isString(Haystack);</span>
<span class="line" id="L1183">    <span class="tok-kw">const</span> needle_is_str = <span class="tok-kw">comptime</span> isString(Needle);</span>
<span class="line" id="L1184"></span>
<span class="line" id="L1185">    <span class="tok-comment">// Check the type of `haystack`.</span>
</span>
<span class="line" id="L1186">    <span class="tok-comment">//</span>
</span>
<span class="line" id="L1187">    <span class="tok-comment">// `haystack` must be an array, tuple, slice, or string.</span>
</span>
<span class="line" id="L1188">    <span class="tok-kw">const</span> haystack_is_valid = <span class="tok-kw">comptime</span> <span class="tok-kw">switch</span> (haystack_info) {</span>
<span class="line" id="L1189">        .Pointer =&gt; |info| is_valid: {</span>
<span class="line" id="L1190">            <span class="tok-kw">if</span> (info.size == .Slice) {</span>
<span class="line" id="L1191">                <span class="tok-kw">break</span> :is_valid <span class="tok-null">true</span>;</span>
<span class="line" id="L1192">            }</span>
<span class="line" id="L1193"></span>
<span class="line" id="L1194">            <span class="tok-kw">if</span> (info.size == .One <span class="tok-kw">and</span> <span class="tok-builtin">@typeInfo</span>(info.child) == .Array) {</span>
<span class="line" id="L1195">                <span class="tok-kw">break</span> :is_valid <span class="tok-null">true</span>;</span>
<span class="line" id="L1196">            }</span>
<span class="line" id="L1197"></span>
<span class="line" id="L1198">            <span class="tok-kw">break</span> :is_valid haystack_is_str;</span>
<span class="line" id="L1199">        },</span>
<span class="line" id="L1200">        .Array =&gt; <span class="tok-null">true</span>,</span>
<span class="line" id="L1201">        .Struct =&gt; |info| info.is_tuple,</span>
<span class="line" id="L1202">        <span class="tok-kw">else</span> =&gt; <span class="tok-null">false</span>,</span>
<span class="line" id="L1203">    };</span>
<span class="line" id="L1204"></span>
<span class="line" id="L1205">    <span class="tok-kw">if</span> (!haystack_is_valid) {</span>
<span class="line" id="L1206">        <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L1207">            <span class="tok-str">&quot;type is not searchable: {s}&quot;</span>,</span>
<span class="line" id="L1208">            .{<span class="tok-builtin">@typeName</span>(Haystack)},</span>
<span class="line" id="L1209">        );</span>
<span class="line" id="L1210">        <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L1211">    }</span>
<span class="line" id="L1212"></span>
<span class="line" id="L1213">    <span class="tok-comment">// Check the type of `needle`.</span>
</span>
<span class="line" id="L1214">    <span class="tok-comment">//</span>
</span>
<span class="line" id="L1215">    <span class="tok-comment">// If `haystack` is a string, `needle` can be a string, comptime_int, or u8.</span>
</span>
<span class="line" id="L1216">    <span class="tok-comment">//</span>
</span>
<span class="line" id="L1217">    <span class="tok-comment">// If `haystack` is an array or a non-string slice, `needle` must be the</span>
</span>
<span class="line" id="L1218">    <span class="tok-comment">// child type of `haystack`.</span>
</span>
<span class="line" id="L1219">    <span class="tok-comment">//</span>
</span>
<span class="line" id="L1220">    <span class="tok-comment">// If `haystack` is a tuple, `needle` must be one of the child types of</span>
</span>
<span class="line" id="L1221">    <span class="tok-comment">// `haystack`.</span>
</span>
<span class="line" id="L1222">    <span class="tok-kw">const</span> needle_is_valid = <span class="tok-kw">comptime</span> <span class="tok-kw">switch</span> (haystack_info) {</span>
<span class="line" id="L1223">        .Pointer =&gt; |info| is_valid: {</span>
<span class="line" id="L1224">            <span class="tok-kw">if</span> (haystack_is_str) {</span>
<span class="line" id="L1225">                <span class="tok-kw">switch</span> (Needle) {</span>
<span class="line" id="L1226">                    <span class="tok-type">comptime_int</span>, <span class="tok-type">u8</span> =&gt; <span class="tok-kw">break</span> :is_valid <span class="tok-null">true</span>,</span>
<span class="line" id="L1227">                    <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L1228">                        <span class="tok-kw">if</span> (needle_is_str) {</span>
<span class="line" id="L1229">                            <span class="tok-kw">break</span> :is_valid <span class="tok-null">true</span>;</span>
<span class="line" id="L1230">                        }</span>
<span class="line" id="L1231">                    },</span>
<span class="line" id="L1232">                }</span>
<span class="line" id="L1233"></span>
<span class="line" id="L1234">                <span class="tok-kw">break</span> :is_valid <span class="tok-null">false</span>;</span>
<span class="line" id="L1235">            }</span>
<span class="line" id="L1236"></span>
<span class="line" id="L1237">            <span class="tok-kw">break</span> :is_valid <span class="tok-kw">switch</span> (info.size) {</span>
<span class="line" id="L1238">                .Slice =&gt; Needle == meta.Child(Haystack),</span>
<span class="line" id="L1239">                .One =&gt; Needle == meta.Child(meta.Child(Haystack)),</span>
<span class="line" id="L1240">                <span class="tok-kw">else</span> =&gt; <span class="tok-null">false</span>,</span>
<span class="line" id="L1241">            };</span>
<span class="line" id="L1242">        },</span>
<span class="line" id="L1243">        .Array =&gt; Needle == meta.Child(Haystack),</span>
<span class="line" id="L1244">        .Struct =&gt; is_valid: {</span>
<span class="line" id="L1245">            <span class="tok-kw">for</span> (meta.fields(Haystack)) |f| {</span>
<span class="line" id="L1246">                <span class="tok-kw">if</span> (Needle == f.<span class="tok-type">type</span>) {</span>
<span class="line" id="L1247">                    <span class="tok-kw">break</span> :is_valid <span class="tok-null">true</span>;</span>
<span class="line" id="L1248">                }</span>
<span class="line" id="L1249">            }</span>
<span class="line" id="L1250"></span>
<span class="line" id="L1251">            <span class="tok-kw">break</span> :is_valid <span class="tok-null">false</span>;</span>
<span class="line" id="L1252">        },</span>
<span class="line" id="L1253">        <span class="tok-comment">// UNREACHABLE: We've already checked that `haystack` is either an</span>
</span>
<span class="line" id="L1254">        <span class="tok-comment">// array, pointer, or tuple.</span>
</span>
<span class="line" id="L1255">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L1256">    };</span>
<span class="line" id="L1257"></span>
<span class="line" id="L1258">    <span class="tok-kw">if</span> (!needle_is_valid) {</span>
<span class="line" id="L1259">        <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L1260">            <span class="tok-str">&quot;invalid 'needle' type: {s}&quot;</span>,</span>
<span class="line" id="L1261">            .{<span class="tok-builtin">@typeName</span>(Needle)},</span>
<span class="line" id="L1262">        );</span>
<span class="line" id="L1263">        <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L1264">    }</span>
<span class="line" id="L1265"></span>
<span class="line" id="L1266">    <span class="tok-comment">// Search for `needle` in `haystack`.</span>
</span>
<span class="line" id="L1267">    <span class="tok-kw">switch</span> (haystack_info) {</span>
<span class="line" id="L1268">        .Pointer =&gt; |h_info| {</span>
<span class="line" id="L1269">            <span class="tok-kw">if</span> (haystack_is_str) {</span>
<span class="line" id="L1270">                <span class="tok-kw">if</span> (needle_is_str) {</span>
<span class="line" id="L1271">                    <span class="tok-kw">if</span> (mem.indexOfPos(<span class="tok-type">u8</span>, haystack, <span class="tok-number">0</span>, needle)) |_| {</span>
<span class="line" id="L1272">                        <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1273">                    }</span>
<span class="line" id="L1274">                } <span class="tok-kw">else</span> <span class="tok-kw">if</span> (mem.indexOfPos(<span class="tok-type">u8</span>, haystack, <span class="tok-number">0</span>, &amp;.{needle})) |_| {</span>
<span class="line" id="L1275">                    <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1276">                }</span>
<span class="line" id="L1277"></span>
<span class="line" id="L1278">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1279">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1280">                <span class="tok-kw">comptime</span> assert(h_info.size == .Slice <span class="tok-kw">or</span> h_info.size == .One);</span>
<span class="line" id="L1281"></span>
<span class="line" id="L1282">                <span class="tok-kw">for</span> (haystack) |elem| {</span>
<span class="line" id="L1283">                    <span class="tok-kw">if</span> (deepEqual(needle, elem)) {</span>
<span class="line" id="L1284">                        <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1285">                    }</span>
<span class="line" id="L1286">                }</span>
<span class="line" id="L1287"></span>
<span class="line" id="L1288">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1289">            }</span>
<span class="line" id="L1290">        },</span>
<span class="line" id="L1291">        .Array =&gt; <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (haystack) |elem| {</span>
<span class="line" id="L1292">            <span class="tok-kw">if</span> (deepEqual(needle, elem)) {</span>
<span class="line" id="L1293">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1294">            }</span>
<span class="line" id="L1295">        },</span>
<span class="line" id="L1296">        .Struct =&gt; <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (haystack) |elem| {</span>
<span class="line" id="L1297">            <span class="tok-kw">if</span> (deepEqual(needle, elem)) {</span>
<span class="line" id="L1298">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1299">            }</span>
<span class="line" id="L1300">        },</span>
<span class="line" id="L1301">        <span class="tok-comment">// UNREACHABLE: We've already checked that `haystack` is either an</span>
</span>
<span class="line" id="L1302">        <span class="tok-comment">// array, pointer, or tuple.</span>
</span>
<span class="line" id="L1303">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L1304">    }</span>
<span class="line" id="L1305"></span>
<span class="line" id="L1306">    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1307">}</span>
<span class="line" id="L1308"></span>
<span class="line" id="L1309"><span class="tok-kw">fn</span> <span class="tok-fn">deepEqual</span>(expected: <span class="tok-kw">anytype</span>, value: <span class="tok-kw">anytype</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L1310">    <span class="tok-kw">const</span> Expected = <span class="tok-builtin">@TypeOf</span>(expected);</span>
<span class="line" id="L1311">    <span class="tok-kw">const</span> expected_info = <span class="tok-builtin">@typeInfo</span>(Expected);</span>
<span class="line" id="L1312">    <span class="tok-kw">const</span> Value = <span class="tok-builtin">@TypeOf</span>(value);</span>
<span class="line" id="L1313"></span>
<span class="line" id="L1314">    <span class="tok-kw">const</span> e_is_str = <span class="tok-kw">comptime</span> isString(Expected);</span>
<span class="line" id="L1315">    <span class="tok-kw">const</span> v_is_str = <span class="tok-kw">comptime</span> isString(Value);</span>
<span class="line" id="L1316">    <span class="tok-kw">if</span> (e_is_str) {</span>
<span class="line" id="L1317">        <span class="tok-kw">if</span> (!v_is_str) {</span>
<span class="line" id="L1318">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1319">        }</span>
<span class="line" id="L1320">    } <span class="tok-kw">else</span> <span class="tok-kw">if</span> (Value != Expected) {</span>
<span class="line" id="L1321">        <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1322">    }</span>
<span class="line" id="L1323"></span>
<span class="line" id="L1324">    <span class="tok-kw">switch</span> (expected_info) {</span>
<span class="line" id="L1325">        <span class="tok-comment">// Invalid values.</span>
</span>
<span class="line" id="L1326">        .AnyFrame,</span>
<span class="line" id="L1327">        .Frame,</span>
<span class="line" id="L1328">        .NoReturn,</span>
<span class="line" id="L1329">        .Opaque,</span>
<span class="line" id="L1330">        =&gt; {</span>
<span class="line" id="L1331">            <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L1332">                <span class="tok-str">&quot;type is not comparable: {s}&quot;</span>,</span>
<span class="line" id="L1333">                .{<span class="tok-builtin">@typeName</span>(Expected)},</span>
<span class="line" id="L1334">            );</span>
<span class="line" id="L1335">            <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L1336">        },</span>
<span class="line" id="L1337"></span>
<span class="line" id="L1338">        <span class="tok-comment">// Values that are always equal.</span>
</span>
<span class="line" id="L1339">        .Null,</span>
<span class="line" id="L1340">        .Undefined,</span>
<span class="line" id="L1341">        .Void,</span>
<span class="line" id="L1342">        =&gt; <span class="tok-kw">return</span> <span class="tok-null">true</span>,</span>
<span class="line" id="L1343"></span>
<span class="line" id="L1344">        <span class="tok-comment">// Values comparable with == and !=.</span>
</span>
<span class="line" id="L1345">        .Bool,</span>
<span class="line" id="L1346">        .ComptimeFloat,</span>
<span class="line" id="L1347">        .ComptimeInt,</span>
<span class="line" id="L1348">        .Enum,</span>
<span class="line" id="L1349">        .EnumLiteral,</span>
<span class="line" id="L1350">        .ErrorSet,</span>
<span class="line" id="L1351">        .Float,</span>
<span class="line" id="L1352">        .Fn,</span>
<span class="line" id="L1353">        .Int,</span>
<span class="line" id="L1354">        .Type,</span>
<span class="line" id="L1355">        =&gt; <span class="tok-kw">if</span> (value != expected) <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L1356"></span>
<span class="line" id="L1357">        .Array,</span>
<span class="line" id="L1358">        .Vector,</span>
<span class="line" id="L1359">        =&gt; <span class="tok-kw">for</span> (expected, value) |e, v| {</span>
<span class="line" id="L1360">            <span class="tok-kw">if</span> (!deepEqual(e, v)) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1361">        },</span>
<span class="line" id="L1362"></span>
<span class="line" id="L1363">        .ErrorUnion =&gt; {</span>
<span class="line" id="L1364">            <span class="tok-kw">if</span> (expected) |e_payload| {</span>
<span class="line" id="L1365">                <span class="tok-kw">if</span> (value) |v_payload| {</span>
<span class="line" id="L1366">                    <span class="tok-kw">return</span> deepEqual(e_payload, v_payload);</span>
<span class="line" id="L1367">                }</span>
<span class="line" id="L1368"></span>
<span class="line" id="L1369">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1370">            } <span class="tok-kw">else</span> |e_err| {</span>
<span class="line" id="L1371">                <span class="tok-kw">if</span> (value) |_| {</span>
<span class="line" id="L1372">                    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1373">                } <span class="tok-kw">else</span> |v_err| {</span>
<span class="line" id="L1374">                    <span class="tok-kw">return</span> deepEqual(e_err, v_err);</span>
<span class="line" id="L1375">                }</span>
<span class="line" id="L1376">            }</span>
<span class="line" id="L1377">        },</span>
<span class="line" id="L1378">        .Optional =&gt; {</span>
<span class="line" id="L1379">            <span class="tok-kw">if</span> (expected) |e_payload| {</span>
<span class="line" id="L1380">                <span class="tok-kw">if</span> (value) |v_payload| {</span>
<span class="line" id="L1381">                    <span class="tok-kw">return</span> deepEqual(e_payload, v_payload);</span>
<span class="line" id="L1382">                }</span>
<span class="line" id="L1383"></span>
<span class="line" id="L1384">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1385">            }</span>
<span class="line" id="L1386"></span>
<span class="line" id="L1387">            <span class="tok-kw">if</span> (value) |_| <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1388">        },</span>
<span class="line" id="L1389">        .Pointer =&gt; |info| <span class="tok-kw">switch</span> (info.size) {</span>
<span class="line" id="L1390">            .Slice =&gt; {</span>
<span class="line" id="L1391">                <span class="tok-kw">if</span> (expected.len != value.len) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1392">                <span class="tok-kw">for</span> (expected, value) |e, v| {</span>
<span class="line" id="L1393">                    <span class="tok-kw">if</span> (!deepEqual(e, v)) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1394">                }</span>
<span class="line" id="L1395">            },</span>
<span class="line" id="L1396">            .One =&gt; <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(info.child)) {</span>
<span class="line" id="L1397">                .Fn, .Opaque =&gt; <span class="tok-kw">if</span> (value != expected) <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L1398">                <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (e_is_str) {</span>
<span class="line" id="L1399">                    <span class="tok-kw">comptime</span> assert(v_is_str);</span>
<span class="line" id="L1400"></span>
<span class="line" id="L1401">                    <span class="tok-kw">if</span> (expected.len != value.len) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1402">                    <span class="tok-kw">for</span> (expected, value) |e, v| {</span>
<span class="line" id="L1403">                        <span class="tok-kw">if</span> (!deepEqual(e, v)) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1404">                    }</span>
<span class="line" id="L1405">                } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1406">                    <span class="tok-kw">return</span> deepEqual(expected.*, value.*);</span>
<span class="line" id="L1407">                },</span>
<span class="line" id="L1408">            },</span>
<span class="line" id="L1409">            .C, .Many =&gt; <span class="tok-kw">if</span> (value != expected) <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L1410">        },</span>
<span class="line" id="L1411">        .Struct =&gt; |info| <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (info.fields) |field| {</span>
<span class="line" id="L1412">            <span class="tok-kw">const</span> e = <span class="tok-builtin">@field</span>(expected, field.name);</span>
<span class="line" id="L1413">            <span class="tok-kw">const</span> v = <span class="tok-builtin">@field</span>(value, field.name);</span>
<span class="line" id="L1414"></span>
<span class="line" id="L1415">            <span class="tok-kw">if</span> (!deepEqual(e, v)) {</span>
<span class="line" id="L1416">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1417">            }</span>
<span class="line" id="L1418">        },</span>
<span class="line" id="L1419">        .Union =&gt; |info| {</span>
<span class="line" id="L1420">            <span class="tok-kw">if</span> (info.tag_type == <span class="tok-null">null</span>) {</span>
<span class="line" id="L1421">                <span class="tok-kw">const</span> err = fmt.comptimePrint(</span>
<span class="line" id="L1422">                    <span class="tok-str">&quot;type is not comparable: {s}&quot;</span>,</span>
<span class="line" id="L1423">                    .{<span class="tok-builtin">@typeName</span>(Expected)},</span>
<span class="line" id="L1424">                );</span>
<span class="line" id="L1425">                <span class="tok-builtin">@compileError</span>(err);</span>
<span class="line" id="L1426">            }</span>
<span class="line" id="L1427"></span>
<span class="line" id="L1428">            <span class="tok-kw">switch</span> (expected) {</span>
<span class="line" id="L1429">                <span class="tok-kw">inline</span> <span class="tok-kw">else</span> =&gt; |e, tag| {</span>
<span class="line" id="L1430">                    <span class="tok-kw">const</span> v = <span class="tok-builtin">@field</span>(value, <span class="tok-builtin">@tagName</span>(tag));</span>
<span class="line" id="L1431">                    <span class="tok-kw">return</span> deepEqual(e, v);</span>
<span class="line" id="L1432">                },</span>
<span class="line" id="L1433">            }</span>
<span class="line" id="L1434">        },</span>
<span class="line" id="L1435">    }</span>
<span class="line" id="L1436"></span>
<span class="line" id="L1437">    <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L1438">}</span>
<span class="line" id="L1439"></span>
<span class="line" id="L1440"><span class="tok-kw">fn</span> <span class="tok-fn">diffLists</span>(listA: <span class="tok-kw">anytype</span>, listB: <span class="tok-kw">anytype</span>) ![<span class="tok-number">2</span>][]<span class="tok-type">usize</span> {</span>
<span class="line" id="L1441">    assert(isList(<span class="tok-builtin">@TypeOf</span>(listA)) <span class="tok-kw">and</span> isList(<span class="tok-builtin">@TypeOf</span>(listB)));</span>
<span class="line" id="L1442"></span>
<span class="line" id="L1443">    <span class="tok-kw">const</span> a_is_tuple = <span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(listA)) == .Struct;</span>
<span class="line" id="L1444">    <span class="tok-kw">const</span> b_is_tuple = <span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(listB)) == .Struct;</span>
<span class="line" id="L1445"></span>
<span class="line" id="L1446">    <span class="tok-kw">var</span> visited = [_]<span class="tok-type">bool</span>{<span class="tok-null">false</span>} ** listB.len;</span>
<span class="line" id="L1447"></span>
<span class="line" id="L1448">    <span class="tok-kw">var</span> extraA = ArrayList(<span class="tok-type">usize</span>).init(test_ally);</span>
<span class="line" id="L1449">    <span class="tok-kw">var</span> extraB = ArrayList(<span class="tok-type">usize</span>).init(test_ally);</span>
<span class="line" id="L1450">    <span class="tok-kw">defer</span> extraA.deinit();</span>
<span class="line" id="L1451">    <span class="tok-kw">defer</span> extraB.deinit();</span>
<span class="line" id="L1452"></span>
<span class="line" id="L1453">    <span class="tok-kw">if</span> (a_is_tuple) {</span>
<span class="line" id="L1454">        <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (listA, <span class="tok-number">0</span>..) |elemA, i| {</span>
<span class="line" id="L1455">            <span class="tok-kw">var</span> found = <span class="tok-null">false</span>;</span>
<span class="line" id="L1456"></span>
<span class="line" id="L1457">            <span class="tok-kw">if</span> (b_is_tuple) {</span>
<span class="line" id="L1458">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (listB, <span class="tok-number">0</span>..) |elemB, j| {</span>
<span class="line" id="L1459">                    <span class="tok-kw">if</span> (!visited[j] <span class="tok-kw">and</span> deepEqual(elemB, elemA)) {</span>
<span class="line" id="L1460">                        visited[j] = <span class="tok-null">true</span>;</span>
<span class="line" id="L1461">                        found = <span class="tok-null">true</span>;</span>
<span class="line" id="L1462">                    }</span>
<span class="line" id="L1463">                }</span>
<span class="line" id="L1464">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1465">                <span class="tok-kw">for</span> (listB, <span class="tok-number">0</span>..) |elemB, j| {</span>
<span class="line" id="L1466">                    <span class="tok-kw">if</span> (visited[j]) {</span>
<span class="line" id="L1467">                        <span class="tok-kw">continue</span>;</span>
<span class="line" id="L1468">                    }</span>
<span class="line" id="L1469">                    <span class="tok-kw">if</span> (deepEqual(elemB, elemA)) {</span>
<span class="line" id="L1470">                        visited[j] = <span class="tok-null">true</span>;</span>
<span class="line" id="L1471">                        found = <span class="tok-null">true</span>;</span>
<span class="line" id="L1472">                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L1473">                    }</span>
<span class="line" id="L1474">                }</span>
<span class="line" id="L1475">            }</span>
<span class="line" id="L1476"></span>
<span class="line" id="L1477">            <span class="tok-kw">if</span> (!found) {</span>
<span class="line" id="L1478">                <span class="tok-kw">try</span> extraA.append(i);</span>
<span class="line" id="L1479">            }</span>
<span class="line" id="L1480">        }</span>
<span class="line" id="L1481">    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1482">        <span class="tok-kw">for</span> (listA, <span class="tok-number">0</span>..) |elemA, i| {</span>
<span class="line" id="L1483">            <span class="tok-kw">var</span> found = <span class="tok-null">false</span>;</span>
<span class="line" id="L1484"></span>
<span class="line" id="L1485">            <span class="tok-kw">if</span> (b_is_tuple) {</span>
<span class="line" id="L1486">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (listB, <span class="tok-number">0</span>..) |elemB, j| {</span>
<span class="line" id="L1487">                    <span class="tok-kw">if</span> (!visited[j] <span class="tok-kw">and</span> deepEqual(elemB, elemA)) {</span>
<span class="line" id="L1488">                        visited[j] = <span class="tok-null">true</span>;</span>
<span class="line" id="L1489">                        found = <span class="tok-null">true</span>;</span>
<span class="line" id="L1490">                    }</span>
<span class="line" id="L1491">                }</span>
<span class="line" id="L1492">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1493">                <span class="tok-kw">for</span> (listB, <span class="tok-number">0</span>..) |elemB, j| {</span>
<span class="line" id="L1494">                    <span class="tok-kw">if</span> (visited[j]) {</span>
<span class="line" id="L1495">                        <span class="tok-kw">continue</span>;</span>
<span class="line" id="L1496">                    }</span>
<span class="line" id="L1497">                    <span class="tok-kw">if</span> (deepEqual(elemB, elemA)) {</span>
<span class="line" id="L1498">                        visited[j] = <span class="tok-null">true</span>;</span>
<span class="line" id="L1499">                        found = <span class="tok-null">true</span>;</span>
<span class="line" id="L1500">                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L1501">                    }</span>
<span class="line" id="L1502">                }</span>
<span class="line" id="L1503">            }</span>
<span class="line" id="L1504"></span>
<span class="line" id="L1505">            <span class="tok-kw">if</span> (!found) {</span>
<span class="line" id="L1506">                <span class="tok-kw">try</span> extraA.append(i);</span>
<span class="line" id="L1507">            }</span>
<span class="line" id="L1508">        }</span>
<span class="line" id="L1509">    }</span>
<span class="line" id="L1510"></span>
<span class="line" id="L1511">    <span class="tok-kw">if</span> (b_is_tuple) {</span>
<span class="line" id="L1512">        <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (visited, <span class="tok-number">0</span>..) |seen, i| {</span>
<span class="line" id="L1513">            <span class="tok-kw">if</span> (!seen) {</span>
<span class="line" id="L1514">                <span class="tok-kw">try</span> extraB.append(i);</span>
<span class="line" id="L1515">            }</span>
<span class="line" id="L1516">        }</span>
<span class="line" id="L1517">    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L1518">        <span class="tok-kw">for</span> (visited, <span class="tok-number">0</span>..) |seen, i| {</span>
<span class="line" id="L1519">            <span class="tok-kw">if</span> (seen) {</span>
<span class="line" id="L1520">                <span class="tok-kw">continue</span>;</span>
<span class="line" id="L1521">            }</span>
<span class="line" id="L1522"></span>
<span class="line" id="L1523">            <span class="tok-kw">try</span> extraB.append(i);</span>
<span class="line" id="L1524">        }</span>
<span class="line" id="L1525">    }</span>
<span class="line" id="L1526"></span>
<span class="line" id="L1527">    <span class="tok-kw">return</span> [_][]<span class="tok-type">usize</span>{</span>
<span class="line" id="L1528">        <span class="tok-kw">try</span> extraA.toOwnedSlice(),</span>
<span class="line" id="L1529">        <span class="tok-kw">try</span> extraB.toOwnedSlice(),</span>
<span class="line" id="L1530">    };</span>
<span class="line" id="L1531">}</span>
<span class="line" id="L1532"></span>
</code></pre></body>
</html>