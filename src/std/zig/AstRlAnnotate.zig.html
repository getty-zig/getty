<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>zig/AstRlAnnotate.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTQwIj48ZyBmaWxsPSIjRjdBNDFEIj48Zz48cG9seWdvbiBwb2ludHM9IjQ2LDIyIDI4LDQ0IDE5LDMwIi8+PHBvbHlnb24gcG9pbnRzPSI0NiwyMiAzMywzMyAyOCw0NCAyMiw0NCAyMiw5NSAzMSw5NSAyMCwxMDAgMTIsMTE3IDAsMTE3IDAsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMzEsOTUgMTIsMTE3IDQsMTA2Ii8+PC9nPjxnPjxwb2x5Z29uIHBvaW50cz0iNTYsMjIgNjIsMzYgMzcsNDQiLz48cG9seWdvbiBwb2ludHM9IjU2LDIyIDExMSwyMiAxMTEsNDQgMzcsNDQgNTYsMzIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTE2LDk1IDk3LDExNyA5MCwxMDQiLz48cG9seWdvbiBwb2ludHM9IjExNiw5NSAxMDAsMTA0IDk3LDExNyA0MiwxMTcgNDIsOTUiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTUwLDAgNTIsMTE3IDMsMTQwIDEwMSwyMiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjE0MSwyMiAxNDAsNDAgMTIyLDQ1Ii8+PHBvbHlnb24gcG9pbnRzPSIxNTMsMjIgMTUzLDExNyAxMDYsMTE3IDEyMCwxMDUgMTI1LDk1IDEzMSw5NSAxMzEsNDUgMTIyLDQ1IDEzMiwzNiAxNDEsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTI1LDk1IDEzMCwxMTAgMTA2LDExNyIvPjwvZz48L2c+PC9zdmc+">
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-comment">//! AstRlAnnotate is a simple pass which runs over the AST before AstGen to</span></span>
<span class="line" id="L2"><span class="tok-comment">//! determine which expressions require result locations.</span></span>
<span class="line" id="L3"><span class="tok-comment">//!</span></span>
<span class="line" id="L4"><span class="tok-comment">//! In some cases, AstGen can choose whether to provide a result pointer or to</span></span>
<span class="line" id="L5"><span class="tok-comment">//! just use standard `break` instructions from a block. The latter choice can</span></span>
<span class="line" id="L6"><span class="tok-comment">//! result in more efficient ZIR and runtime code, but does not allow for RLS to</span></span>
<span class="line" id="L7"><span class="tok-comment">//! occur. Thus, we want to provide a real result pointer (from an alloc) only</span></span>
<span class="line" id="L8"><span class="tok-comment">//! when necessary.</span></span>
<span class="line" id="L9"><span class="tok-comment">//!</span></span>
<span class="line" id="L10"><span class="tok-comment">//! To achive this, we need to determine which expressions require a result</span></span>
<span class="line" id="L11"><span class="tok-comment">//! pointer. This pass is reponsible for analyzing all syntax forms which may</span></span>
<span class="line" id="L12"><span class="tok-comment">//! provide a result location and, if sub-expressions consume this result</span></span>
<span class="line" id="L13"><span class="tok-comment">//! pointer non-trivially (e.g. writing through field pointers), marking the</span></span>
<span class="line" id="L14"><span class="tok-comment">//! node as requiring a result location.</span></span>
<span class="line" id="L15"></span>
<span class="line" id="L16"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L17"><span class="tok-kw">const</span> AstRlAnnotate = <span class="tok-builtin">@This</span>();</span>
<span class="line" id="L18"><span class="tok-kw">const</span> Ast = std.zig.Ast;</span>
<span class="line" id="L19"><span class="tok-kw">const</span> Allocator = std.mem.Allocator;</span>
<span class="line" id="L20"><span class="tok-kw">const</span> AutoHashMapUnmanaged = std.AutoHashMapUnmanaged;</span>
<span class="line" id="L21"><span class="tok-kw">const</span> BuiltinFn = std.zig.BuiltinFn;</span>
<span class="line" id="L22"><span class="tok-kw">const</span> assert = std.debug.assert;</span>
<span class="line" id="L23"></span>
<span class="line" id="L24">gpa: Allocator,</span>
<span class="line" id="L25">arena: Allocator,</span>
<span class="line" id="L26">tree: *<span class="tok-kw">const</span> Ast,</span>
<span class="line" id="L27"></span>
<span class="line" id="L28"><span class="tok-comment">/// Certain nodes are placed in this set under the following conditions:</span></span>
<span class="line" id="L29"><span class="tok-comment">/// * if-else: either branch consumes the result location</span></span>
<span class="line" id="L30"><span class="tok-comment">/// * labeled block: any break consumes the result location</span></span>
<span class="line" id="L31"><span class="tok-comment">/// * switch: any prong consumes the result location</span></span>
<span class="line" id="L32"><span class="tok-comment">/// * orelse/catch: the RHS expression consumes the result location</span></span>
<span class="line" id="L33"><span class="tok-comment">/// * while/for: any break consumes the result location</span></span>
<span class="line" id="L34"><span class="tok-comment">/// * @as: the second operand consumes the result location</span></span>
<span class="line" id="L35"><span class="tok-comment">/// * const: the init expression consumes the result location</span></span>
<span class="line" id="L36"><span class="tok-comment">/// * return: the return expression consumes the result location</span></span>
<span class="line" id="L37">nodes_need_rl: RlNeededSet = .{},</span>
<span class="line" id="L38"></span>
<span class="line" id="L39"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> RlNeededSet = AutoHashMapUnmanaged(Ast.Node.Index, <span class="tok-type">void</span>);</span>
<span class="line" id="L40"></span>
<span class="line" id="L41"><span class="tok-kw">const</span> ResultInfo = <span class="tok-kw">packed</span> <span class="tok-kw">struct</span> {</span>
<span class="line" id="L42">    <span class="tok-comment">/// Do we have a known result type?</span></span>
<span class="line" id="L43">    have_type: <span class="tok-type">bool</span>,</span>
<span class="line" id="L44">    <span class="tok-comment">/// Do we (potentially) have a result pointer? Note that this pointer's type</span></span>
<span class="line" id="L45">    <span class="tok-comment">/// may not be known due to it being an inferred alloc.</span></span>
<span class="line" id="L46">    have_ptr: <span class="tok-type">bool</span>,</span>
<span class="line" id="L47"></span>
<span class="line" id="L48">    <span class="tok-kw">const</span> none: ResultInfo = .{ .have_type = <span class="tok-null">false</span>, .have_ptr = <span class="tok-null">false</span> };</span>
<span class="line" id="L49">    <span class="tok-kw">const</span> typed_ptr: ResultInfo = .{ .have_type = <span class="tok-null">true</span>, .have_ptr = <span class="tok-null">true</span> };</span>
<span class="line" id="L50">    <span class="tok-kw">const</span> inferred_ptr: ResultInfo = .{ .have_type = <span class="tok-null">false</span>, .have_ptr = <span class="tok-null">true</span> };</span>
<span class="line" id="L51">    <span class="tok-kw">const</span> type_only: ResultInfo = .{ .have_type = <span class="tok-null">true</span>, .have_ptr = <span class="tok-null">false</span> };</span>
<span class="line" id="L52">};</span>
<span class="line" id="L53"></span>
<span class="line" id="L54"><span class="tok-comment">/// A labeled block or a loop. When this block is broken from, `consumes_res_ptr`</span></span>
<span class="line" id="L55"><span class="tok-comment">/// should be set if the break expression consumed the result pointer.</span></span>
<span class="line" id="L56"><span class="tok-kw">const</span> Block = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L57">    parent: ?*Block,</span>
<span class="line" id="L58">    label: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L59">    is_loop: <span class="tok-type">bool</span>,</span>
<span class="line" id="L60">    ri: ResultInfo,</span>
<span class="line" id="L61">    consumes_res_ptr: <span class="tok-type">bool</span>,</span>
<span class="line" id="L62">};</span>
<span class="line" id="L63"></span>
<span class="line" id="L64"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">annotate</span>(gpa: Allocator, arena: Allocator, tree: Ast) Allocator.Error!RlNeededSet {</span>
<span class="line" id="L65">    <span class="tok-kw">var</span> astrl: AstRlAnnotate = .{</span>
<span class="line" id="L66">        .gpa = gpa,</span>
<span class="line" id="L67">        .arena = arena,</span>
<span class="line" id="L68">        .tree = &amp;tree,</span>
<span class="line" id="L69">    };</span>
<span class="line" id="L70">    <span class="tok-kw">defer</span> astrl.deinit(gpa);</span>
<span class="line" id="L71"></span>
<span class="line" id="L72">    <span class="tok-kw">if</span> (tree.errors.len != <span class="tok-number">0</span>) {</span>
<span class="line" id="L73">        <span class="tok-comment">// We can't perform analysis on a broken AST. AstGen will not run in</span>
</span>
<span class="line" id="L74">        <span class="tok-comment">// this case.</span>
</span>
<span class="line" id="L75">        <span class="tok-kw">return</span> .{};</span>
<span class="line" id="L76">    }</span>
<span class="line" id="L77"></span>
<span class="line" id="L78">    <span class="tok-kw">for</span> (tree.containerDeclRoot().ast.members) |member_node| {</span>
<span class="line" id="L79">        _ = <span class="tok-kw">try</span> astrl.expr(member_node, <span class="tok-null">null</span>, ResultInfo.none);</span>
<span class="line" id="L80">    }</span>
<span class="line" id="L81"></span>
<span class="line" id="L82">    <span class="tok-kw">return</span> astrl.nodes_need_rl.move();</span>
<span class="line" id="L83">}</span>
<span class="line" id="L84"></span>
<span class="line" id="L85"><span class="tok-kw">fn</span> <span class="tok-fn">deinit</span>(astrl: *AstRlAnnotate, gpa: Allocator) <span class="tok-type">void</span> {</span>
<span class="line" id="L86">    astrl.nodes_need_rl.deinit(gpa);</span>
<span class="line" id="L87">}</span>
<span class="line" id="L88"></span>
<span class="line" id="L89"><span class="tok-kw">fn</span> <span class="tok-fn">containerDecl</span>(</span>
<span class="line" id="L90">    astrl: *AstRlAnnotate,</span>
<span class="line" id="L91">    block: ?*Block,</span>
<span class="line" id="L92">    full: Ast.full.ContainerDecl,</span>
<span class="line" id="L93">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L94">    <span class="tok-kw">const</span> tree = astrl.tree;</span>
<span class="line" id="L95">    <span class="tok-kw">const</span> token_tags = tree.tokens.items(.tag);</span>
<span class="line" id="L96">    <span class="tok-kw">switch</span> (token_tags[full.ast.main_token]) {</span>
<span class="line" id="L97">        .keyword_struct =&gt; {</span>
<span class="line" id="L98">            <span class="tok-kw">if</span> (full.ast.arg != <span class="tok-number">0</span>) {</span>
<span class="line" id="L99">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.arg, block, ResultInfo.type_only);</span>
<span class="line" id="L100">            }</span>
<span class="line" id="L101">            <span class="tok-kw">for</span> (full.ast.members) |member_node| {</span>
<span class="line" id="L102">                _ = <span class="tok-kw">try</span> astrl.expr(member_node, block, ResultInfo.none);</span>
<span class="line" id="L103">            }</span>
<span class="line" id="L104">        },</span>
<span class="line" id="L105">        .keyword_union =&gt; {</span>
<span class="line" id="L106">            <span class="tok-kw">if</span> (full.ast.arg != <span class="tok-number">0</span>) {</span>
<span class="line" id="L107">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.arg, block, ResultInfo.type_only);</span>
<span class="line" id="L108">            }</span>
<span class="line" id="L109">            <span class="tok-kw">for</span> (full.ast.members) |member_node| {</span>
<span class="line" id="L110">                _ = <span class="tok-kw">try</span> astrl.expr(member_node, block, ResultInfo.none);</span>
<span class="line" id="L111">            }</span>
<span class="line" id="L112">        },</span>
<span class="line" id="L113">        .keyword_enum =&gt; {</span>
<span class="line" id="L114">            <span class="tok-kw">if</span> (full.ast.arg != <span class="tok-number">0</span>) {</span>
<span class="line" id="L115">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.arg, block, ResultInfo.type_only);</span>
<span class="line" id="L116">            }</span>
<span class="line" id="L117">            <span class="tok-kw">for</span> (full.ast.members) |member_node| {</span>
<span class="line" id="L118">                _ = <span class="tok-kw">try</span> astrl.expr(member_node, block, ResultInfo.none);</span>
<span class="line" id="L119">            }</span>
<span class="line" id="L120">        },</span>
<span class="line" id="L121">        .keyword_opaque =&gt; {</span>
<span class="line" id="L122">            <span class="tok-kw">for</span> (full.ast.members) |member_node| {</span>
<span class="line" id="L123">                _ = <span class="tok-kw">try</span> astrl.expr(member_node, block, ResultInfo.none);</span>
<span class="line" id="L124">            }</span>
<span class="line" id="L125">        },</span>
<span class="line" id="L126">        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L127">    }</span>
<span class="line" id="L128">}</span>
<span class="line" id="L129"></span>
<span class="line" id="L130"><span class="tok-comment">/// Returns true if `rl` provides a result pointer and the expression consumes it.</span></span>
<span class="line" id="L131"><span class="tok-kw">fn</span> <span class="tok-fn">expr</span>(astrl: *AstRlAnnotate, node: Ast.Node.Index, block: ?*Block, ri: ResultInfo) Allocator.Error!<span class="tok-type">bool</span> {</span>
<span class="line" id="L132">    <span class="tok-kw">const</span> tree = astrl.tree;</span>
<span class="line" id="L133">    <span class="tok-kw">const</span> token_tags = tree.tokens.items(.tag);</span>
<span class="line" id="L134">    <span class="tok-kw">const</span> node_datas = tree.nodes.items(.data);</span>
<span class="line" id="L135">    <span class="tok-kw">const</span> node_tags = tree.nodes.items(.tag);</span>
<span class="line" id="L136">    <span class="tok-kw">switch</span> (node_tags[node]) {</span>
<span class="line" id="L137">        .root,</span>
<span class="line" id="L138">        .switch_case_one,</span>
<span class="line" id="L139">        .switch_case_inline_one,</span>
<span class="line" id="L140">        .switch_case,</span>
<span class="line" id="L141">        .switch_case_inline,</span>
<span class="line" id="L142">        .switch_range,</span>
<span class="line" id="L143">        .for_range,</span>
<span class="line" id="L144">        .asm_output,</span>
<span class="line" id="L145">        .asm_input,</span>
<span class="line" id="L146">        =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L147"></span>
<span class="line" id="L148">        .@&quot;errdefer&quot;, .@&quot;defer&quot; =&gt; {</span>
<span class="line" id="L149">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L150">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L151">        },</span>
<span class="line" id="L152"></span>
<span class="line" id="L153">        .container_field_init,</span>
<span class="line" id="L154">        .container_field_align,</span>
<span class="line" id="L155">        .container_field,</span>
<span class="line" id="L156">        =&gt; {</span>
<span class="line" id="L157">            <span class="tok-kw">const</span> full = tree.fullContainerField(node).?;</span>
<span class="line" id="L158">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.type_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L159">            <span class="tok-kw">if</span> (full.ast.align_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L160">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.align_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L161">            }</span>
<span class="line" id="L162">            <span class="tok-kw">if</span> (full.ast.value_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L163">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.value_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L164">            }</span>
<span class="line" id="L165">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L166">        },</span>
<span class="line" id="L167">        .@&quot;usingnamespace&quot; =&gt; {</span>
<span class="line" id="L168">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L169">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L170">        },</span>
<span class="line" id="L171">        .test_decl =&gt; {</span>
<span class="line" id="L172">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L173">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L174">        },</span>
<span class="line" id="L175">        .global_var_decl,</span>
<span class="line" id="L176">        .local_var_decl,</span>
<span class="line" id="L177">        .simple_var_decl,</span>
<span class="line" id="L178">        .aligned_var_decl,</span>
<span class="line" id="L179">        =&gt; {</span>
<span class="line" id="L180">            <span class="tok-kw">const</span> full = tree.fullVarDecl(node).?;</span>
<span class="line" id="L181">            <span class="tok-kw">const</span> init_ri = <span class="tok-kw">if</span> (full.ast.type_node != <span class="tok-number">0</span>) init_ri: {</span>
<span class="line" id="L182">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.type_node, block, ResultInfo.type_only);</span>
<span class="line" id="L183">                <span class="tok-kw">break</span> :init_ri ResultInfo.typed_ptr;</span>
<span class="line" id="L184">            } <span class="tok-kw">else</span> ResultInfo.inferred_ptr;</span>
<span class="line" id="L185">            <span class="tok-kw">if</span> (full.ast.init_node == <span class="tok-number">0</span>) {</span>
<span class="line" id="L186">                <span class="tok-comment">// No init node, so we're done.</span>
</span>
<span class="line" id="L187">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L188">            }</span>
<span class="line" id="L189">            <span class="tok-kw">switch</span> (token_tags[full.ast.mut_token]) {</span>
<span class="line" id="L190">                .keyword_const =&gt; {</span>
<span class="line" id="L191">                    <span class="tok-kw">const</span> init_consumes_rl = <span class="tok-kw">try</span> astrl.expr(full.ast.init_node, block, init_ri);</span>
<span class="line" id="L192">                    <span class="tok-kw">if</span> (init_consumes_rl) {</span>
<span class="line" id="L193">                        <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L194">                    }</span>
<span class="line" id="L195">                    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L196">                },</span>
<span class="line" id="L197">                .keyword_var =&gt; {</span>
<span class="line" id="L198">                    <span class="tok-comment">// We'll create an alloc either way, so don't care if the</span>
</span>
<span class="line" id="L199">                    <span class="tok-comment">// result pointer is consumed.</span>
</span>
<span class="line" id="L200">                    _ = <span class="tok-kw">try</span> astrl.expr(full.ast.init_node, block, init_ri);</span>
<span class="line" id="L201">                    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L202">                },</span>
<span class="line" id="L203">                <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L204">            }</span>
<span class="line" id="L205">        },</span>
<span class="line" id="L206">        .assign_destructure =&gt; {</span>
<span class="line" id="L207">            <span class="tok-kw">const</span> lhs_count = tree.extra_data[node_datas[node].lhs];</span>
<span class="line" id="L208">            <span class="tok-kw">const</span> all_lhs = tree.extra_data[node_datas[node].lhs + <span class="tok-number">1</span> ..][<span class="tok-number">0</span>..lhs_count];</span>
<span class="line" id="L209">            <span class="tok-kw">for</span> (all_lhs) |lhs| {</span>
<span class="line" id="L210">                _ = <span class="tok-kw">try</span> astrl.expr(lhs, block, ResultInfo.none);</span>
<span class="line" id="L211">            }</span>
<span class="line" id="L212">            <span class="tok-comment">// We don't need to gather any meaningful data here, because destructures always use RLS</span>
</span>
<span class="line" id="L213">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L214">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L215">        },</span>
<span class="line" id="L216">        .assign =&gt; {</span>
<span class="line" id="L217">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L218">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.typed_ptr);</span>
<span class="line" id="L219">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L220">        },</span>
<span class="line" id="L221">        .assign_shl,</span>
<span class="line" id="L222">        .assign_shl_sat,</span>
<span class="line" id="L223">        .assign_shr,</span>
<span class="line" id="L224">        .assign_bit_and,</span>
<span class="line" id="L225">        .assign_bit_or,</span>
<span class="line" id="L226">        .assign_bit_xor,</span>
<span class="line" id="L227">        .assign_div,</span>
<span class="line" id="L228">        .assign_sub,</span>
<span class="line" id="L229">        .assign_sub_wrap,</span>
<span class="line" id="L230">        .assign_sub_sat,</span>
<span class="line" id="L231">        .assign_mod,</span>
<span class="line" id="L232">        .assign_add,</span>
<span class="line" id="L233">        .assign_add_wrap,</span>
<span class="line" id="L234">        .assign_add_sat,</span>
<span class="line" id="L235">        .assign_mul,</span>
<span class="line" id="L236">        .assign_mul_wrap,</span>
<span class="line" id="L237">        .assign_mul_sat,</span>
<span class="line" id="L238">        =&gt; {</span>
<span class="line" id="L239">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L240">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L241">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L242">        },</span>
<span class="line" id="L243">        .shl, .shr =&gt; {</span>
<span class="line" id="L244">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L245">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L246">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L247">        },</span>
<span class="line" id="L248">        .add,</span>
<span class="line" id="L249">        .add_wrap,</span>
<span class="line" id="L250">        .add_sat,</span>
<span class="line" id="L251">        .sub,</span>
<span class="line" id="L252">        .sub_wrap,</span>
<span class="line" id="L253">        .sub_sat,</span>
<span class="line" id="L254">        .mul,</span>
<span class="line" id="L255">        .mul_wrap,</span>
<span class="line" id="L256">        .mul_sat,</span>
<span class="line" id="L257">        .div,</span>
<span class="line" id="L258">        .mod,</span>
<span class="line" id="L259">        .shl_sat,</span>
<span class="line" id="L260">        .bit_and,</span>
<span class="line" id="L261">        .bit_or,</span>
<span class="line" id="L262">        .bit_xor,</span>
<span class="line" id="L263">        .bang_equal,</span>
<span class="line" id="L264">        .equal_equal,</span>
<span class="line" id="L265">        .greater_than,</span>
<span class="line" id="L266">        .greater_or_equal,</span>
<span class="line" id="L267">        .less_than,</span>
<span class="line" id="L268">        .less_or_equal,</span>
<span class="line" id="L269">        .array_cat,</span>
<span class="line" id="L270">        =&gt; {</span>
<span class="line" id="L271">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L272">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L273">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L274">        },</span>
<span class="line" id="L275">        .array_mult =&gt; {</span>
<span class="line" id="L276">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L277">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L278">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L279">        },</span>
<span class="line" id="L280">        .error_union, .merge_error_sets =&gt; {</span>
<span class="line" id="L281">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L282">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L283">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L284">        },</span>
<span class="line" id="L285">        .bool_and,</span>
<span class="line" id="L286">        .bool_or,</span>
<span class="line" id="L287">        =&gt; {</span>
<span class="line" id="L288">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L289">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L290">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L291">        },</span>
<span class="line" id="L292">        .bool_not =&gt; {</span>
<span class="line" id="L293">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L294">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L295">        },</span>
<span class="line" id="L296">        .bit_not, .negation, .negation_wrap =&gt; {</span>
<span class="line" id="L297">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L298">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L299">        },</span>
<span class="line" id="L300"></span>
<span class="line" id="L301">        <span class="tok-comment">// These nodes are leaves and never consume a result location.</span>
</span>
<span class="line" id="L302">        .identifier,</span>
<span class="line" id="L303">        .string_literal,</span>
<span class="line" id="L304">        .multiline_string_literal,</span>
<span class="line" id="L305">        .number_literal,</span>
<span class="line" id="L306">        .unreachable_literal,</span>
<span class="line" id="L307">        .asm_simple,</span>
<span class="line" id="L308">        .@&quot;asm&quot;,</span>
<span class="line" id="L309">        .enum_literal,</span>
<span class="line" id="L310">        .error_value,</span>
<span class="line" id="L311">        .anyframe_literal,</span>
<span class="line" id="L312">        .@&quot;continue&quot;,</span>
<span class="line" id="L313">        .char_literal,</span>
<span class="line" id="L314">        .error_set_decl,</span>
<span class="line" id="L315">        =&gt; <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L316"></span>
<span class="line" id="L317">        .builtin_call_two, .builtin_call_two_comma =&gt; {</span>
<span class="line" id="L318">            <span class="tok-kw">if</span> (node_datas[node].lhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L319">                <span class="tok-kw">return</span> astrl.builtinCall(block, ri, node, &amp;.{});</span>
<span class="line" id="L320">            } <span class="tok-kw">else</span> <span class="tok-kw">if</span> (node_datas[node].rhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L321">                <span class="tok-kw">return</span> astrl.builtinCall(block, ri, node, &amp;.{node_datas[node].lhs});</span>
<span class="line" id="L322">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L323">                <span class="tok-kw">return</span> astrl.builtinCall(block, ri, node, &amp;.{ node_datas[node].lhs, node_datas[node].rhs });</span>
<span class="line" id="L324">            }</span>
<span class="line" id="L325">        },</span>
<span class="line" id="L326">        .builtin_call, .builtin_call_comma =&gt; {</span>
<span class="line" id="L327">            <span class="tok-kw">const</span> params = tree.extra_data[node_datas[node].lhs..node_datas[node].rhs];</span>
<span class="line" id="L328">            <span class="tok-kw">return</span> astrl.builtinCall(block, ri, node, params);</span>
<span class="line" id="L329">        },</span>
<span class="line" id="L330"></span>
<span class="line" id="L331">        .call_one,</span>
<span class="line" id="L332">        .call_one_comma,</span>
<span class="line" id="L333">        .async_call_one,</span>
<span class="line" id="L334">        .async_call_one_comma,</span>
<span class="line" id="L335">        .call,</span>
<span class="line" id="L336">        .call_comma,</span>
<span class="line" id="L337">        .async_call,</span>
<span class="line" id="L338">        .async_call_comma,</span>
<span class="line" id="L339">        =&gt; {</span>
<span class="line" id="L340">            <span class="tok-kw">var</span> buf: [<span class="tok-number">1</span>]Ast.Node.Index = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L341">            <span class="tok-kw">const</span> full = tree.fullCall(&amp;buf, node).?;</span>
<span class="line" id="L342">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.fn_expr, block, ResultInfo.none);</span>
<span class="line" id="L343">            <span class="tok-kw">for</span> (full.ast.params) |param_node| {</span>
<span class="line" id="L344">                _ = <span class="tok-kw">try</span> astrl.expr(param_node, block, ResultInfo.type_only);</span>
<span class="line" id="L345">            }</span>
<span class="line" id="L346">            <span class="tok-kw">return</span> <span class="tok-kw">switch</span> (node_tags[node]) {</span>
<span class="line" id="L347">                .call_one,</span>
<span class="line" id="L348">                .call_one_comma,</span>
<span class="line" id="L349">                .call,</span>
<span class="line" id="L350">                .call_comma,</span>
<span class="line" id="L351">                =&gt; <span class="tok-null">false</span>, <span class="tok-comment">// TODO: once function calls are passed result locations this will change</span>
</span>
<span class="line" id="L352">                .async_call_one,</span>
<span class="line" id="L353">                .async_call_one_comma,</span>
<span class="line" id="L354">                .async_call,</span>
<span class="line" id="L355">                .async_call_comma,</span>
<span class="line" id="L356">                =&gt; ri.have_ptr, <span class="tok-comment">// always use result ptr for frames</span>
</span>
<span class="line" id="L357">                <span class="tok-kw">else</span> =&gt; <span class="tok-kw">unreachable</span>,</span>
<span class="line" id="L358">            };</span>
<span class="line" id="L359">        },</span>
<span class="line" id="L360"></span>
<span class="line" id="L361">        .@&quot;return&quot; =&gt; {</span>
<span class="line" id="L362">            <span class="tok-kw">if</span> (node_datas[node].lhs != <span class="tok-number">0</span>) {</span>
<span class="line" id="L363">                <span class="tok-kw">const</span> ret_val_consumes_rl = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.typed_ptr);</span>
<span class="line" id="L364">                <span class="tok-kw">if</span> (ret_val_consumes_rl) {</span>
<span class="line" id="L365">                    <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L366">                }</span>
<span class="line" id="L367">            }</span>
<span class="line" id="L368">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L369">        },</span>
<span class="line" id="L370"></span>
<span class="line" id="L371">        .field_access =&gt; {</span>
<span class="line" id="L372">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L373">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L374">        },</span>
<span class="line" id="L375"></span>
<span class="line" id="L376">        .if_simple, .@&quot;if&quot; =&gt; {</span>
<span class="line" id="L377">            <span class="tok-kw">const</span> full = tree.fullIf(node).?;</span>
<span class="line" id="L378">            <span class="tok-kw">if</span> (full.error_token != <span class="tok-null">null</span> <span class="tok-kw">or</span> full.payload_token != <span class="tok-null">null</span>) {</span>
<span class="line" id="L379">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.cond_expr, block, ResultInfo.none);</span>
<span class="line" id="L380">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L381">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.cond_expr, block, ResultInfo.type_only); <span class="tok-comment">// bool</span>
</span>
<span class="line" id="L382">            }</span>
<span class="line" id="L383"></span>
<span class="line" id="L384">            <span class="tok-kw">if</span> (full.ast.else_expr == <span class="tok-number">0</span>) {</span>
<span class="line" id="L385">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.then_expr, block, ResultInfo.none);</span>
<span class="line" id="L386">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L387">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L388">                <span class="tok-kw">const</span> then_uses_rl = <span class="tok-kw">try</span> astrl.expr(full.ast.then_expr, block, ri);</span>
<span class="line" id="L389">                <span class="tok-kw">const</span> else_uses_rl = <span class="tok-kw">try</span> astrl.expr(full.ast.else_expr, block, ri);</span>
<span class="line" id="L390">                <span class="tok-kw">const</span> uses_rl = then_uses_rl <span class="tok-kw">or</span> else_uses_rl;</span>
<span class="line" id="L391">                <span class="tok-kw">if</span> (uses_rl) <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L392">                <span class="tok-kw">return</span> uses_rl;</span>
<span class="line" id="L393">            }</span>
<span class="line" id="L394">        },</span>
<span class="line" id="L395"></span>
<span class="line" id="L396">        .while_simple, .while_cont, .@&quot;while&quot; =&gt; {</span>
<span class="line" id="L397">            <span class="tok-kw">const</span> full = tree.fullWhile(node).?;</span>
<span class="line" id="L398">            <span class="tok-kw">const</span> label: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-kw">if</span> (full.label_token) |label_token| label: {</span>
<span class="line" id="L399">                <span class="tok-kw">break</span> :label <span class="tok-kw">try</span> astrl.identString(label_token);</span>
<span class="line" id="L400">            } <span class="tok-kw">else</span> <span class="tok-null">null</span>;</span>
<span class="line" id="L401">            <span class="tok-kw">if</span> (full.error_token != <span class="tok-null">null</span> <span class="tok-kw">or</span> full.payload_token != <span class="tok-null">null</span>) {</span>
<span class="line" id="L402">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.cond_expr, block, ResultInfo.none);</span>
<span class="line" id="L403">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L404">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.cond_expr, block, ResultInfo.type_only); <span class="tok-comment">// bool</span>
</span>
<span class="line" id="L405">            }</span>
<span class="line" id="L406">            <span class="tok-kw">var</span> new_block: Block = .{</span>
<span class="line" id="L407">                .parent = block,</span>
<span class="line" id="L408">                .label = label,</span>
<span class="line" id="L409">                .is_loop = <span class="tok-null">true</span>,</span>
<span class="line" id="L410">                .ri = ri,</span>
<span class="line" id="L411">                .consumes_res_ptr = <span class="tok-null">false</span>,</span>
<span class="line" id="L412">            };</span>
<span class="line" id="L413">            <span class="tok-kw">if</span> (full.ast.cont_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L414">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.cont_expr, &amp;new_block, ResultInfo.none);</span>
<span class="line" id="L415">            }</span>
<span class="line" id="L416">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.then_expr, &amp;new_block, ResultInfo.none);</span>
<span class="line" id="L417">            <span class="tok-kw">const</span> else_consumes_rl = <span class="tok-kw">if</span> (full.ast.else_expr != <span class="tok-number">0</span>) else_rl: {</span>
<span class="line" id="L418">                <span class="tok-kw">break</span> :else_rl <span class="tok-kw">try</span> astrl.expr(full.ast.else_expr, block, ri);</span>
<span class="line" id="L419">            } <span class="tok-kw">else</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L420">            <span class="tok-kw">if</span> (new_block.consumes_res_ptr <span class="tok-kw">or</span> else_consumes_rl) {</span>
<span class="line" id="L421">                <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L422">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L423">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L424">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L425">            }</span>
<span class="line" id="L426">        },</span>
<span class="line" id="L427"></span>
<span class="line" id="L428">        .for_simple, .@&quot;for&quot; =&gt; {</span>
<span class="line" id="L429">            <span class="tok-kw">const</span> full = tree.fullFor(node).?;</span>
<span class="line" id="L430">            <span class="tok-kw">const</span> label: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-kw">if</span> (full.label_token) |label_token| label: {</span>
<span class="line" id="L431">                <span class="tok-kw">break</span> :label <span class="tok-kw">try</span> astrl.identString(label_token);</span>
<span class="line" id="L432">            } <span class="tok-kw">else</span> <span class="tok-null">null</span>;</span>
<span class="line" id="L433">            <span class="tok-kw">for</span> (full.ast.inputs) |input| {</span>
<span class="line" id="L434">                <span class="tok-kw">if</span> (node_tags[input] == .for_range) {</span>
<span class="line" id="L435">                    _ = <span class="tok-kw">try</span> astrl.expr(node_datas[input].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L436">                    <span class="tok-kw">if</span> (node_datas[input].rhs != <span class="tok-number">0</span>) {</span>
<span class="line" id="L437">                        _ = <span class="tok-kw">try</span> astrl.expr(node_datas[input].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L438">                    }</span>
<span class="line" id="L439">                } <span class="tok-kw">else</span> {</span>
<span class="line" id="L440">                    _ = <span class="tok-kw">try</span> astrl.expr(input, block, ResultInfo.none);</span>
<span class="line" id="L441">                }</span>
<span class="line" id="L442">            }</span>
<span class="line" id="L443">            <span class="tok-kw">var</span> new_block: Block = .{</span>
<span class="line" id="L444">                .parent = block,</span>
<span class="line" id="L445">                .label = label,</span>
<span class="line" id="L446">                .is_loop = <span class="tok-null">true</span>,</span>
<span class="line" id="L447">                .ri = ri,</span>
<span class="line" id="L448">                .consumes_res_ptr = <span class="tok-null">false</span>,</span>
<span class="line" id="L449">            };</span>
<span class="line" id="L450">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.then_expr, &amp;new_block, ResultInfo.none);</span>
<span class="line" id="L451">            <span class="tok-kw">const</span> else_consumes_rl = <span class="tok-kw">if</span> (full.ast.else_expr != <span class="tok-number">0</span>) else_rl: {</span>
<span class="line" id="L452">                <span class="tok-kw">break</span> :else_rl <span class="tok-kw">try</span> astrl.expr(full.ast.else_expr, block, ri);</span>
<span class="line" id="L453">            } <span class="tok-kw">else</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L454">            <span class="tok-kw">if</span> (new_block.consumes_res_ptr <span class="tok-kw">or</span> else_consumes_rl) {</span>
<span class="line" id="L455">                <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L456">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L457">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L458">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L459">            }</span>
<span class="line" id="L460">        },</span>
<span class="line" id="L461"></span>
<span class="line" id="L462">        .slice_open =&gt; {</span>
<span class="line" id="L463">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L464">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L465">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L466">        },</span>
<span class="line" id="L467">        .slice =&gt; {</span>
<span class="line" id="L468">            <span class="tok-kw">const</span> extra = tree.extraData(node_datas[node].rhs, Ast.Node.Slice);</span>
<span class="line" id="L469">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L470">            _ = <span class="tok-kw">try</span> astrl.expr(extra.start, block, ResultInfo.type_only);</span>
<span class="line" id="L471">            _ = <span class="tok-kw">try</span> astrl.expr(extra.end, block, ResultInfo.type_only);</span>
<span class="line" id="L472">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L473">        },</span>
<span class="line" id="L474">        .slice_sentinel =&gt; {</span>
<span class="line" id="L475">            <span class="tok-kw">const</span> extra = tree.extraData(node_datas[node].rhs, Ast.Node.SliceSentinel);</span>
<span class="line" id="L476">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L477">            _ = <span class="tok-kw">try</span> astrl.expr(extra.start, block, ResultInfo.type_only);</span>
<span class="line" id="L478">            <span class="tok-kw">if</span> (extra.end != <span class="tok-number">0</span>) {</span>
<span class="line" id="L479">                _ = <span class="tok-kw">try</span> astrl.expr(extra.end, block, ResultInfo.type_only);</span>
<span class="line" id="L480">            }</span>
<span class="line" id="L481">            _ = <span class="tok-kw">try</span> astrl.expr(extra.sentinel, block, ResultInfo.none);</span>
<span class="line" id="L482">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L483">        },</span>
<span class="line" id="L484">        .deref =&gt; {</span>
<span class="line" id="L485">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L486">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L487">        },</span>
<span class="line" id="L488">        .address_of =&gt; {</span>
<span class="line" id="L489">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L490">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L491">        },</span>
<span class="line" id="L492">        .optional_type =&gt; {</span>
<span class="line" id="L493">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L494">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L495">        },</span>
<span class="line" id="L496">        .grouped_expression,</span>
<span class="line" id="L497">        .@&quot;try&quot;,</span>
<span class="line" id="L498">        .@&quot;await&quot;,</span>
<span class="line" id="L499">        .@&quot;nosuspend&quot;,</span>
<span class="line" id="L500">        .unwrap_optional,</span>
<span class="line" id="L501">        =&gt; <span class="tok-kw">return</span> astrl.expr(node_datas[node].lhs, block, ri),</span>
<span class="line" id="L502"></span>
<span class="line" id="L503">        .block_two, .block_two_semicolon =&gt; {</span>
<span class="line" id="L504">            <span class="tok-kw">if</span> (node_datas[node].lhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L505">                <span class="tok-kw">return</span> astrl.blockExpr(block, ri, node, &amp;.{});</span>
<span class="line" id="L506">            } <span class="tok-kw">else</span> <span class="tok-kw">if</span> (node_datas[node].rhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L507">                <span class="tok-kw">return</span> astrl.blockExpr(block, ri, node, &amp;.{node_datas[node].lhs});</span>
<span class="line" id="L508">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L509">                <span class="tok-kw">return</span> astrl.blockExpr(block, ri, node, &amp;.{ node_datas[node].lhs, node_datas[node].rhs });</span>
<span class="line" id="L510">            }</span>
<span class="line" id="L511">        },</span>
<span class="line" id="L512">        .block, .block_semicolon =&gt; {</span>
<span class="line" id="L513">            <span class="tok-kw">const</span> statements = tree.extra_data[node_datas[node].lhs..node_datas[node].rhs];</span>
<span class="line" id="L514">            <span class="tok-kw">return</span> astrl.blockExpr(block, ri, node, statements);</span>
<span class="line" id="L515">        },</span>
<span class="line" id="L516">        .anyframe_type =&gt; {</span>
<span class="line" id="L517">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L518">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L519">        },</span>
<span class="line" id="L520">        .@&quot;catch&quot;, .@&quot;orelse&quot; =&gt; {</span>
<span class="line" id="L521">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L522">            <span class="tok-kw">const</span> rhs_consumes_rl = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ri);</span>
<span class="line" id="L523">            <span class="tok-kw">if</span> (rhs_consumes_rl) {</span>
<span class="line" id="L524">                <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L525">            }</span>
<span class="line" id="L526">            <span class="tok-kw">return</span> rhs_consumes_rl;</span>
<span class="line" id="L527">        },</span>
<span class="line" id="L528"></span>
<span class="line" id="L529">        .ptr_type_aligned,</span>
<span class="line" id="L530">        .ptr_type_sentinel,</span>
<span class="line" id="L531">        .ptr_type,</span>
<span class="line" id="L532">        .ptr_type_bit_range,</span>
<span class="line" id="L533">        =&gt; {</span>
<span class="line" id="L534">            <span class="tok-kw">const</span> full = tree.fullPtrType(node).?;</span>
<span class="line" id="L535">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.child_type, block, ResultInfo.type_only);</span>
<span class="line" id="L536">            <span class="tok-kw">if</span> (full.ast.sentinel != <span class="tok-number">0</span>) {</span>
<span class="line" id="L537">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.sentinel, block, ResultInfo.type_only);</span>
<span class="line" id="L538">            }</span>
<span class="line" id="L539">            <span class="tok-kw">if</span> (full.ast.addrspace_node != <span class="tok-number">0</span>) {</span>
<span class="line" id="L540">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.addrspace_node, block, ResultInfo.type_only);</span>
<span class="line" id="L541">            }</span>
<span class="line" id="L542">            <span class="tok-kw">if</span> (full.ast.align_node != <span class="tok-number">0</span>) {</span>
<span class="line" id="L543">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.align_node, block, ResultInfo.type_only);</span>
<span class="line" id="L544">            }</span>
<span class="line" id="L545">            <span class="tok-kw">if</span> (full.ast.bit_range_start != <span class="tok-number">0</span>) {</span>
<span class="line" id="L546">                assert(full.ast.bit_range_end != <span class="tok-number">0</span>);</span>
<span class="line" id="L547">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.bit_range_start, block, ResultInfo.type_only);</span>
<span class="line" id="L548">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.bit_range_end, block, ResultInfo.type_only);</span>
<span class="line" id="L549">            }</span>
<span class="line" id="L550">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L551">        },</span>
<span class="line" id="L552"></span>
<span class="line" id="L553">        .container_decl,</span>
<span class="line" id="L554">        .container_decl_trailing,</span>
<span class="line" id="L555">        .container_decl_arg,</span>
<span class="line" id="L556">        .container_decl_arg_trailing,</span>
<span class="line" id="L557">        .container_decl_two,</span>
<span class="line" id="L558">        .container_decl_two_trailing,</span>
<span class="line" id="L559">        .tagged_union,</span>
<span class="line" id="L560">        .tagged_union_trailing,</span>
<span class="line" id="L561">        .tagged_union_enum_tag,</span>
<span class="line" id="L562">        .tagged_union_enum_tag_trailing,</span>
<span class="line" id="L563">        .tagged_union_two,</span>
<span class="line" id="L564">        .tagged_union_two_trailing,</span>
<span class="line" id="L565">        =&gt; {</span>
<span class="line" id="L566">            <span class="tok-kw">var</span> buf: [<span class="tok-number">2</span>]Ast.Node.Index = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L567">            <span class="tok-kw">try</span> astrl.containerDecl(block, tree.fullContainerDecl(&amp;buf, node).?);</span>
<span class="line" id="L568">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L569">        },</span>
<span class="line" id="L570"></span>
<span class="line" id="L571">        .@&quot;break&quot; =&gt; {</span>
<span class="line" id="L572">            <span class="tok-kw">if</span> (node_datas[node].rhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L573">                <span class="tok-comment">// Breaks with void are not interesting</span>
</span>
<span class="line" id="L574">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L575">            }</span>
<span class="line" id="L576"></span>
<span class="line" id="L577">            <span class="tok-kw">var</span> opt_cur_block = block;</span>
<span class="line" id="L578">            <span class="tok-kw">if</span> (node_datas[node].lhs == <span class="tok-number">0</span>) {</span>
<span class="line" id="L579">                <span class="tok-comment">// No label - we're breaking from a loop.</span>
</span>
<span class="line" id="L580">                <span class="tok-kw">while</span> (opt_cur_block) |cur_block| : (opt_cur_block = cur_block.parent) {</span>
<span class="line" id="L581">                    <span class="tok-kw">if</span> (cur_block.is_loop) <span class="tok-kw">break</span>;</span>
<span class="line" id="L582">                }</span>
<span class="line" id="L583">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L584">                <span class="tok-kw">const</span> break_label = <span class="tok-kw">try</span> astrl.identString(node_datas[node].lhs);</span>
<span class="line" id="L585">                <span class="tok-kw">while</span> (opt_cur_block) |cur_block| : (opt_cur_block = cur_block.parent) {</span>
<span class="line" id="L586">                    <span class="tok-kw">const</span> block_label = cur_block.label <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L587">                    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, block_label, break_label)) <span class="tok-kw">break</span>;</span>
<span class="line" id="L588">                }</span>
<span class="line" id="L589">            }</span>
<span class="line" id="L590"></span>
<span class="line" id="L591">            <span class="tok-kw">if</span> (opt_cur_block) |target_block| {</span>
<span class="line" id="L592">                <span class="tok-kw">const</span> consumes_break_rl = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, target_block.ri);</span>
<span class="line" id="L593">                <span class="tok-kw">if</span> (consumes_break_rl) target_block.consumes_res_ptr = <span class="tok-null">true</span>;</span>
<span class="line" id="L594">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L595">                <span class="tok-comment">// No corresponding scope to break from - AstGen will emit an error.</span>
</span>
<span class="line" id="L596">                _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L597">            }</span>
<span class="line" id="L598"></span>
<span class="line" id="L599">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L600">        },</span>
<span class="line" id="L601"></span>
<span class="line" id="L602">        .array_type =&gt; {</span>
<span class="line" id="L603">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L604">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L605">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L606">        },</span>
<span class="line" id="L607">        .array_type_sentinel =&gt; {</span>
<span class="line" id="L608">            <span class="tok-kw">const</span> extra = tree.extraData(node_datas[node].rhs, Ast.Node.ArrayTypeSentinel);</span>
<span class="line" id="L609">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.type_only);</span>
<span class="line" id="L610">            _ = <span class="tok-kw">try</span> astrl.expr(extra.elem_type, block, ResultInfo.type_only);</span>
<span class="line" id="L611">            _ = <span class="tok-kw">try</span> astrl.expr(extra.sentinel, block, ResultInfo.type_only);</span>
<span class="line" id="L612">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L613">        },</span>
<span class="line" id="L614">        .array_access =&gt; {</span>
<span class="line" id="L615">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L616">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].rhs, block, ResultInfo.type_only);</span>
<span class="line" id="L617">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L618">        },</span>
<span class="line" id="L619">        .@&quot;comptime&quot; =&gt; {</span>
<span class="line" id="L620">            <span class="tok-comment">// AstGen will emit an error if the scope is already comptime, so we can assume it is</span>
</span>
<span class="line" id="L621">            <span class="tok-comment">// not. This means the result location is not forwarded.</span>
</span>
<span class="line" id="L622">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L623">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L624">        },</span>
<span class="line" id="L625">        .@&quot;switch&quot;, .switch_comma =&gt; {</span>
<span class="line" id="L626">            <span class="tok-kw">const</span> operand_node = node_datas[node].lhs;</span>
<span class="line" id="L627">            <span class="tok-kw">const</span> extra = tree.extraData(node_datas[node].rhs, Ast.Node.SubRange);</span>
<span class="line" id="L628">            <span class="tok-kw">const</span> case_nodes = tree.extra_data[extra.start..extra.end];</span>
<span class="line" id="L629"></span>
<span class="line" id="L630">            _ = <span class="tok-kw">try</span> astrl.expr(operand_node, block, ResultInfo.none);</span>
<span class="line" id="L631"></span>
<span class="line" id="L632">            <span class="tok-kw">var</span> any_prong_consumed_rl = <span class="tok-null">false</span>;</span>
<span class="line" id="L633">            <span class="tok-kw">for</span> (case_nodes) |case_node| {</span>
<span class="line" id="L634">                <span class="tok-kw">const</span> case = tree.fullSwitchCase(case_node).?;</span>
<span class="line" id="L635">                <span class="tok-kw">for</span> (case.ast.values) |item_node| {</span>
<span class="line" id="L636">                    <span class="tok-kw">if</span> (node_tags[item_node] == .switch_range) {</span>
<span class="line" id="L637">                        _ = <span class="tok-kw">try</span> astrl.expr(node_datas[item_node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L638">                        _ = <span class="tok-kw">try</span> astrl.expr(node_datas[item_node].rhs, block, ResultInfo.none);</span>
<span class="line" id="L639">                    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L640">                        _ = <span class="tok-kw">try</span> astrl.expr(item_node, block, ResultInfo.none);</span>
<span class="line" id="L641">                    }</span>
<span class="line" id="L642">                }</span>
<span class="line" id="L643">                <span class="tok-kw">if</span> (<span class="tok-kw">try</span> astrl.expr(case.ast.target_expr, block, ri)) {</span>
<span class="line" id="L644">                    any_prong_consumed_rl = <span class="tok-null">true</span>;</span>
<span class="line" id="L645">                }</span>
<span class="line" id="L646">            }</span>
<span class="line" id="L647">            <span class="tok-kw">if</span> (any_prong_consumed_rl) {</span>
<span class="line" id="L648">                <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L649">            }</span>
<span class="line" id="L650">            <span class="tok-kw">return</span> any_prong_consumed_rl;</span>
<span class="line" id="L651">        },</span>
<span class="line" id="L652">        .@&quot;suspend&quot; =&gt; {</span>
<span class="line" id="L653">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L654">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L655">        },</span>
<span class="line" id="L656">        .@&quot;resume&quot; =&gt; {</span>
<span class="line" id="L657">            _ = <span class="tok-kw">try</span> astrl.expr(node_datas[node].lhs, block, ResultInfo.none);</span>
<span class="line" id="L658">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L659">        },</span>
<span class="line" id="L660"></span>
<span class="line" id="L661">        .array_init_one,</span>
<span class="line" id="L662">        .array_init_one_comma,</span>
<span class="line" id="L663">        .array_init_dot_two,</span>
<span class="line" id="L664">        .array_init_dot_two_comma,</span>
<span class="line" id="L665">        .array_init_dot,</span>
<span class="line" id="L666">        .array_init_dot_comma,</span>
<span class="line" id="L667">        .array_init,</span>
<span class="line" id="L668">        .array_init_comma,</span>
<span class="line" id="L669">        =&gt; {</span>
<span class="line" id="L670">            <span class="tok-kw">var</span> buf: [<span class="tok-number">2</span>]Ast.Node.Index = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L671">            <span class="tok-kw">const</span> full = tree.fullArrayInit(&amp;buf, node).?;</span>
<span class="line" id="L672"></span>
<span class="line" id="L673">            <span class="tok-kw">if</span> (full.ast.type_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L674">                <span class="tok-comment">// Explicitly typed init does not participate in RLS</span>
</span>
<span class="line" id="L675">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.type_expr, block, ResultInfo.none);</span>
<span class="line" id="L676">                <span class="tok-kw">for</span> (full.ast.elements) |elem_init| {</span>
<span class="line" id="L677">                    _ = <span class="tok-kw">try</span> astrl.expr(elem_init, block, ResultInfo.type_only);</span>
<span class="line" id="L678">                }</span>
<span class="line" id="L679">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L680">            }</span>
<span class="line" id="L681"></span>
<span class="line" id="L682">            <span class="tok-kw">if</span> (ri.have_type) {</span>
<span class="line" id="L683">                <span class="tok-comment">// Always forward type information</span>
</span>
<span class="line" id="L684">                <span class="tok-comment">// If we have a result pointer, we use and forward it</span>
</span>
<span class="line" id="L685">                <span class="tok-kw">for</span> (full.ast.elements) |elem_init| {</span>
<span class="line" id="L686">                    _ = <span class="tok-kw">try</span> astrl.expr(elem_init, block, ri);</span>
<span class="line" id="L687">                }</span>
<span class="line" id="L688">                <span class="tok-kw">return</span> ri.have_ptr;</span>
<span class="line" id="L689">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L690">                <span class="tok-comment">// Untyped init does not consume result location</span>
</span>
<span class="line" id="L691">                <span class="tok-kw">for</span> (full.ast.elements) |elem_init| {</span>
<span class="line" id="L692">                    _ = <span class="tok-kw">try</span> astrl.expr(elem_init, block, ResultInfo.none);</span>
<span class="line" id="L693">                }</span>
<span class="line" id="L694">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L695">            }</span>
<span class="line" id="L696">        },</span>
<span class="line" id="L697"></span>
<span class="line" id="L698">        .struct_init_one,</span>
<span class="line" id="L699">        .struct_init_one_comma,</span>
<span class="line" id="L700">        .struct_init_dot_two,</span>
<span class="line" id="L701">        .struct_init_dot_two_comma,</span>
<span class="line" id="L702">        .struct_init_dot,</span>
<span class="line" id="L703">        .struct_init_dot_comma,</span>
<span class="line" id="L704">        .struct_init,</span>
<span class="line" id="L705">        .struct_init_comma,</span>
<span class="line" id="L706">        =&gt; {</span>
<span class="line" id="L707">            <span class="tok-kw">var</span> buf: [<span class="tok-number">2</span>]Ast.Node.Index = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L708">            <span class="tok-kw">const</span> full = tree.fullStructInit(&amp;buf, node).?;</span>
<span class="line" id="L709"></span>
<span class="line" id="L710">            <span class="tok-kw">if</span> (full.ast.type_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L711">                <span class="tok-comment">// Explicitly typed init does not participate in RLS</span>
</span>
<span class="line" id="L712">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.type_expr, block, ResultInfo.none);</span>
<span class="line" id="L713">                <span class="tok-kw">for</span> (full.ast.fields) |field_init| {</span>
<span class="line" id="L714">                    _ = <span class="tok-kw">try</span> astrl.expr(field_init, block, ResultInfo.type_only);</span>
<span class="line" id="L715">                }</span>
<span class="line" id="L716">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L717">            }</span>
<span class="line" id="L718"></span>
<span class="line" id="L719">            <span class="tok-kw">if</span> (ri.have_type) {</span>
<span class="line" id="L720">                <span class="tok-comment">// Always forward type information</span>
</span>
<span class="line" id="L721">                <span class="tok-comment">// If we have a result pointer, we use and forward it</span>
</span>
<span class="line" id="L722">                <span class="tok-kw">for</span> (full.ast.fields) |field_init| {</span>
<span class="line" id="L723">                    _ = <span class="tok-kw">try</span> astrl.expr(field_init, block, ri);</span>
<span class="line" id="L724">                }</span>
<span class="line" id="L725">                <span class="tok-kw">return</span> ri.have_ptr;</span>
<span class="line" id="L726">            } <span class="tok-kw">else</span> {</span>
<span class="line" id="L727">                <span class="tok-comment">// Untyped init does not consume result location</span>
</span>
<span class="line" id="L728">                <span class="tok-kw">for</span> (full.ast.fields) |field_init| {</span>
<span class="line" id="L729">                    _ = <span class="tok-kw">try</span> astrl.expr(field_init, block, ResultInfo.none);</span>
<span class="line" id="L730">                }</span>
<span class="line" id="L731">                <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L732">            }</span>
<span class="line" id="L733">        },</span>
<span class="line" id="L734"></span>
<span class="line" id="L735">        .fn_proto_simple,</span>
<span class="line" id="L736">        .fn_proto_multi,</span>
<span class="line" id="L737">        .fn_proto_one,</span>
<span class="line" id="L738">        .fn_proto,</span>
<span class="line" id="L739">        .fn_decl,</span>
<span class="line" id="L740">        =&gt; {</span>
<span class="line" id="L741">            <span class="tok-kw">var</span> buf: [<span class="tok-number">1</span>]Ast.Node.Index = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L742">            <span class="tok-kw">const</span> full = tree.fullFnProto(&amp;buf, node).?;</span>
<span class="line" id="L743">            <span class="tok-kw">const</span> body_node = <span class="tok-kw">if</span> (node_tags[node] == .fn_decl) node_datas[node].rhs <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L744">            {</span>
<span class="line" id="L745">                <span class="tok-kw">var</span> it = full.iterate(tree);</span>
<span class="line" id="L746">                <span class="tok-kw">while</span> (it.next()) |param| {</span>
<span class="line" id="L747">                    <span class="tok-kw">if</span> (param.anytype_ellipsis3 == <span class="tok-null">null</span>) {</span>
<span class="line" id="L748">                        _ = <span class="tok-kw">try</span> astrl.expr(param.type_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L749">                    }</span>
<span class="line" id="L750">                }</span>
<span class="line" id="L751">            }</span>
<span class="line" id="L752">            <span class="tok-kw">if</span> (full.ast.align_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L753">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.align_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L754">            }</span>
<span class="line" id="L755">            <span class="tok-kw">if</span> (full.ast.addrspace_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L756">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.addrspace_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L757">            }</span>
<span class="line" id="L758">            <span class="tok-kw">if</span> (full.ast.section_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L759">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.section_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L760">            }</span>
<span class="line" id="L761">            <span class="tok-kw">if</span> (full.ast.callconv_expr != <span class="tok-number">0</span>) {</span>
<span class="line" id="L762">                _ = <span class="tok-kw">try</span> astrl.expr(full.ast.callconv_expr, block, ResultInfo.type_only);</span>
<span class="line" id="L763">            }</span>
<span class="line" id="L764">            _ = <span class="tok-kw">try</span> astrl.expr(full.ast.return_type, block, ResultInfo.type_only);</span>
<span class="line" id="L765">            <span class="tok-kw">if</span> (body_node != <span class="tok-number">0</span>) {</span>
<span class="line" id="L766">                _ = <span class="tok-kw">try</span> astrl.expr(body_node, block, ResultInfo.none);</span>
<span class="line" id="L767">            }</span>
<span class="line" id="L768">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L769">        },</span>
<span class="line" id="L770">    }</span>
<span class="line" id="L771">}</span>
<span class="line" id="L772"></span>
<span class="line" id="L773"><span class="tok-kw">fn</span> <span class="tok-fn">identString</span>(astrl: *AstRlAnnotate, token: Ast.TokenIndex) ![]<span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L774">    <span class="tok-kw">const</span> tree = astrl.tree;</span>
<span class="line" id="L775">    <span class="tok-kw">const</span> token_tags = tree.tokens.items(.tag);</span>
<span class="line" id="L776">    assert(token_tags[token] == .identifier);</span>
<span class="line" id="L777">    <span class="tok-kw">const</span> ident_name = tree.tokenSlice(token);</span>
<span class="line" id="L778">    <span class="tok-kw">if</span> (!std.mem.startsWith(<span class="tok-type">u8</span>, ident_name, <span class="tok-str">&quot;@&quot;</span>)) {</span>
<span class="line" id="L779">        <span class="tok-kw">return</span> ident_name;</span>
<span class="line" id="L780">    }</span>
<span class="line" id="L781">    <span class="tok-kw">return</span> std.zig.string_literal.parseAlloc(astrl.arena, ident_name[<span class="tok-number">1</span>..]) <span class="tok-kw">catch</span> |err| <span class="tok-kw">switch</span> (err) {</span>
<span class="line" id="L782">        <span class="tok-kw">error</span>.OutOfMemory =&gt; <span class="tok-kw">error</span>.OutOfMemory,</span>
<span class="line" id="L783">        <span class="tok-kw">error</span>.InvalidLiteral =&gt; <span class="tok-str">&quot;&quot;</span>, <span class="tok-comment">// This pass can safely return garbage on invalid AST</span>
</span>
<span class="line" id="L784">    };</span>
<span class="line" id="L785">}</span>
<span class="line" id="L786"></span>
<span class="line" id="L787"><span class="tok-kw">fn</span> <span class="tok-fn">blockExpr</span>(astrl: *AstRlAnnotate, parent_block: ?*Block, ri: ResultInfo, node: Ast.Node.Index, statements: []<span class="tok-kw">const</span> Ast.Node.Index) !<span class="tok-type">bool</span> {</span>
<span class="line" id="L788">    <span class="tok-kw">const</span> tree = astrl.tree;</span>
<span class="line" id="L789">    <span class="tok-kw">const</span> token_tags = tree.tokens.items(.tag);</span>
<span class="line" id="L790">    <span class="tok-kw">const</span> main_tokens = tree.nodes.items(.main_token);</span>
<span class="line" id="L791"></span>
<span class="line" id="L792">    <span class="tok-kw">const</span> lbrace = main_tokens[node];</span>
<span class="line" id="L793">    <span class="tok-kw">if</span> (token_tags[lbrace - <span class="tok-number">1</span>] == .colon <span class="tok-kw">and</span></span>
<span class="line" id="L794">        token_tags[lbrace - <span class="tok-number">2</span>] == .identifier)</span>
<span class="line" id="L795">    {</span>
<span class="line" id="L796">        <span class="tok-comment">// Labeled block</span>
</span>
<span class="line" id="L797">        <span class="tok-kw">var</span> new_block: Block = .{</span>
<span class="line" id="L798">            .parent = parent_block,</span>
<span class="line" id="L799">            .label = <span class="tok-kw">try</span> astrl.identString(lbrace - <span class="tok-number">2</span>),</span>
<span class="line" id="L800">            .is_loop = <span class="tok-null">false</span>,</span>
<span class="line" id="L801">            .ri = ri,</span>
<span class="line" id="L802">            .consumes_res_ptr = <span class="tok-null">false</span>,</span>
<span class="line" id="L803">        };</span>
<span class="line" id="L804">        <span class="tok-kw">for</span> (statements) |statement| {</span>
<span class="line" id="L805">            _ = <span class="tok-kw">try</span> astrl.expr(statement, &amp;new_block, ResultInfo.none);</span>
<span class="line" id="L806">        }</span>
<span class="line" id="L807">        <span class="tok-kw">if</span> (new_block.consumes_res_ptr) {</span>
<span class="line" id="L808">            <span class="tok-kw">try</span> astrl.nodes_need_rl.putNoClobber(astrl.gpa, node, {});</span>
<span class="line" id="L809">        }</span>
<span class="line" id="L810">        <span class="tok-kw">return</span> new_block.consumes_res_ptr;</span>
<span class="line" id="L811">    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L812">        <span class="tok-comment">// Unlabeled block</span>
</span>
<span class="line" id="L813">        <span class="tok-kw">for</span> (statements) |statement| {</span>
<span class="line" id="L814">            _ = <span class="tok-kw">try</span> astrl.expr(statement, parent_block, ResultInfo.none);</span>
<span class="line" id="L815">        }</span>
<span class="line" id="L816">        <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L817">    }</span>
<span class="line" id="L818">}</span>
<span class="line" id="L819"></span>
<span class="line" id="L820"><span class="tok-kw">fn</span> <span class="tok-fn">builtinCall</span>(astrl: *AstRlAnnotate, block: ?*Block, ri: ResultInfo, node: Ast.Node.Index, args: []<span class="tok-kw">const</span> Ast.Node.Index) !<span class="tok-type">bool</span> {</span>
<span class="line" id="L821">    _ = ri; <span class="tok-comment">// Currently, no builtin consumes its result location.</span>
</span>
<span class="line" id="L822"></span>
<span class="line" id="L823">    <span class="tok-kw">const</span> tree = astrl.tree;</span>
<span class="line" id="L824">    <span class="tok-kw">const</span> main_tokens = tree.nodes.items(.main_token);</span>
<span class="line" id="L825">    <span class="tok-kw">const</span> builtin_token = main_tokens[node];</span>
<span class="line" id="L826">    <span class="tok-kw">const</span> builtin_name = tree.tokenSlice(builtin_token);</span>
<span class="line" id="L827">    <span class="tok-kw">const</span> info = BuiltinFn.list.get(builtin_name) <span class="tok-kw">orelse</span> <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L828">    <span class="tok-kw">if</span> (info.param_count) |expected| {</span>
<span class="line" id="L829">        <span class="tok-kw">if</span> (expected != args.len) <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L830">    }</span>
<span class="line" id="L831">    <span class="tok-kw">switch</span> (info.tag) {</span>
<span class="line" id="L832">        .import =&gt; <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L833">        .compile_log, .TypeOf =&gt; {</span>
<span class="line" id="L834">            <span class="tok-kw">for</span> (args) |arg_node| {</span>
<span class="line" id="L835">                _ = <span class="tok-kw">try</span> astrl.expr(arg_node, block, ResultInfo.none);</span>
<span class="line" id="L836">            }</span>
<span class="line" id="L837">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L838">        },</span>
<span class="line" id="L839">        .as =&gt; {</span>
<span class="line" id="L840">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L841">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L842">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L843">        },</span>
<span class="line" id="L844">        .bit_cast =&gt; {</span>
<span class="line" id="L845">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L846">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L847">        },</span>
<span class="line" id="L848">        .union_init =&gt; {</span>
<span class="line" id="L849">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L850">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L851">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L852">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L853">        },</span>
<span class="line" id="L854">        .c_import =&gt; {</span>
<span class="line" id="L855">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L856">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L857">        },</span>
<span class="line" id="L858">        .min, .max =&gt; {</span>
<span class="line" id="L859">            <span class="tok-kw">for</span> (args) |arg_node| {</span>
<span class="line" id="L860">                _ = <span class="tok-kw">try</span> astrl.expr(arg_node, block, ResultInfo.none);</span>
<span class="line" id="L861">            }</span>
<span class="line" id="L862">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L863">        },</span>
<span class="line" id="L864">        .@&quot;export&quot; =&gt; {</span>
<span class="line" id="L865">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L866">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L867">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L868">        },</span>
<span class="line" id="L869">        .@&quot;extern&quot; =&gt; {</span>
<span class="line" id="L870">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L871">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L872">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L873">        },</span>
<span class="line" id="L874">        <span class="tok-comment">// These builtins take no args and do not consume the result pointer.</span>
</span>
<span class="line" id="L875">        .src,</span>
<span class="line" id="L876">        .This,</span>
<span class="line" id="L877">        .return_address,</span>
<span class="line" id="L878">        .error_return_trace,</span>
<span class="line" id="L879">        .frame,</span>
<span class="line" id="L880">        .breakpoint,</span>
<span class="line" id="L881">        .in_comptime,</span>
<span class="line" id="L882">        .panic,</span>
<span class="line" id="L883">        .trap,</span>
<span class="line" id="L884">        .c_va_start,</span>
<span class="line" id="L885">        =&gt; <span class="tok-kw">return</span> <span class="tok-null">false</span>,</span>
<span class="line" id="L886">        <span class="tok-comment">// TODO: this is a workaround for llvm/llvm-project#68409</span>
</span>
<span class="line" id="L887">        <span class="tok-comment">// Zig tracking issue: #16876</span>
</span>
<span class="line" id="L888">        .frame_address =&gt; <span class="tok-kw">return</span> <span class="tok-null">true</span>,</span>
<span class="line" id="L889">        <span class="tok-comment">// These builtins take a single argument with a known result type, but do not consume their</span>
</span>
<span class="line" id="L890">        <span class="tok-comment">// result pointer.</span>
</span>
<span class="line" id="L891">        .size_of,</span>
<span class="line" id="L892">        .bit_size_of,</span>
<span class="line" id="L893">        .align_of,</span>
<span class="line" id="L894">        .compile_error,</span>
<span class="line" id="L895">        .set_eval_branch_quota,</span>
<span class="line" id="L896">        .int_from_bool,</span>
<span class="line" id="L897">        .int_from_error,</span>
<span class="line" id="L898">        .error_from_int,</span>
<span class="line" id="L899">        .embed_file,</span>
<span class="line" id="L900">        .error_name,</span>
<span class="line" id="L901">        .set_runtime_safety,</span>
<span class="line" id="L902">        .Type,</span>
<span class="line" id="L903">        .c_undef,</span>
<span class="line" id="L904">        .c_include,</span>
<span class="line" id="L905">        .wasm_memory_size,</span>
<span class="line" id="L906">        .splat,</span>
<span class="line" id="L907">        .fence,</span>
<span class="line" id="L908">        .set_float_mode,</span>
<span class="line" id="L909">        .set_align_stack,</span>
<span class="line" id="L910">        .set_cold,</span>
<span class="line" id="L911">        .type_info,</span>
<span class="line" id="L912">        .work_item_id,</span>
<span class="line" id="L913">        .work_group_size,</span>
<span class="line" id="L914">        .work_group_id,</span>
<span class="line" id="L915">        =&gt; {</span>
<span class="line" id="L916">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L917">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L918">        },</span>
<span class="line" id="L919">        <span class="tok-comment">// These builtins take a single argument with no result information and do not consume their</span>
</span>
<span class="line" id="L920">        <span class="tok-comment">// result pointer.</span>
</span>
<span class="line" id="L921">        .int_from_ptr,</span>
<span class="line" id="L922">        .int_from_enum,</span>
<span class="line" id="L923">        .sqrt,</span>
<span class="line" id="L924">        .sin,</span>
<span class="line" id="L925">        .cos,</span>
<span class="line" id="L926">        .tan,</span>
<span class="line" id="L927">        .exp,</span>
<span class="line" id="L928">        .exp2,</span>
<span class="line" id="L929">        .log,</span>
<span class="line" id="L930">        .log2,</span>
<span class="line" id="L931">        .log10,</span>
<span class="line" id="L932">        .abs,</span>
<span class="line" id="L933">        .floor,</span>
<span class="line" id="L934">        .ceil,</span>
<span class="line" id="L935">        .trunc,</span>
<span class="line" id="L936">        .round,</span>
<span class="line" id="L937">        .tag_name,</span>
<span class="line" id="L938">        .type_name,</span>
<span class="line" id="L939">        .Frame,</span>
<span class="line" id="L940">        .frame_size,</span>
<span class="line" id="L941">        .int_from_float,</span>
<span class="line" id="L942">        .float_from_int,</span>
<span class="line" id="L943">        .ptr_from_int,</span>
<span class="line" id="L944">        .enum_from_int,</span>
<span class="line" id="L945">        .float_cast,</span>
<span class="line" id="L946">        .int_cast,</span>
<span class="line" id="L947">        .truncate,</span>
<span class="line" id="L948">        .error_cast,</span>
<span class="line" id="L949">        .ptr_cast,</span>
<span class="line" id="L950">        .align_cast,</span>
<span class="line" id="L951">        .addrspace_cast,</span>
<span class="line" id="L952">        .const_cast,</span>
<span class="line" id="L953">        .volatile_cast,</span>
<span class="line" id="L954">        .clz,</span>
<span class="line" id="L955">        .ctz,</span>
<span class="line" id="L956">        .pop_count,</span>
<span class="line" id="L957">        .byte_swap,</span>
<span class="line" id="L958">        .bit_reverse,</span>
<span class="line" id="L959">        =&gt; {</span>
<span class="line" id="L960">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L961">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L962">        },</span>
<span class="line" id="L963">        .div_exact,</span>
<span class="line" id="L964">        .div_floor,</span>
<span class="line" id="L965">        .div_trunc,</span>
<span class="line" id="L966">        .mod,</span>
<span class="line" id="L967">        .rem,</span>
<span class="line" id="L968">        =&gt; {</span>
<span class="line" id="L969">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L970">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L971">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L972">        },</span>
<span class="line" id="L973">        .shl_exact, .shr_exact =&gt; {</span>
<span class="line" id="L974">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L975">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L976">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L977">        },</span>
<span class="line" id="L978">        .bit_offset_of,</span>
<span class="line" id="L979">        .offset_of,</span>
<span class="line" id="L980">        .field_parent_ptr,</span>
<span class="line" id="L981">        .has_decl,</span>
<span class="line" id="L982">        .has_field,</span>
<span class="line" id="L983">        .field,</span>
<span class="line" id="L984">        =&gt; {</span>
<span class="line" id="L985">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L986">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L987">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L988">        },</span>
<span class="line" id="L989">        .wasm_memory_grow =&gt; {</span>
<span class="line" id="L990">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L991">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L992">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L993">        },</span>
<span class="line" id="L994">        .c_define =&gt; {</span>
<span class="line" id="L995">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L996">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L997">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L998">        },</span>
<span class="line" id="L999">        .reduce =&gt; {</span>
<span class="line" id="L1000">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1001">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1002">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1003">        },</span>
<span class="line" id="L1004">        .add_with_overflow, .sub_with_overflow, .mul_with_overflow, .shl_with_overflow =&gt; {</span>
<span class="line" id="L1005">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1006">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1007">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1008">        },</span>
<span class="line" id="L1009">        .atomic_load =&gt; {</span>
<span class="line" id="L1010">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1011">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1012">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1013">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1014">        },</span>
<span class="line" id="L1015">        .atomic_rmw =&gt; {</span>
<span class="line" id="L1016">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1017">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1018">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1019">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1020">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">4</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1021">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1022">        },</span>
<span class="line" id="L1023">        .atomic_store =&gt; {</span>
<span class="line" id="L1024">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1025">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1026">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1027">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1028">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1029">        },</span>
<span class="line" id="L1030">        .mul_add =&gt; {</span>
<span class="line" id="L1031">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1032">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1033">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1034">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1035">        },</span>
<span class="line" id="L1036">        .call =&gt; {</span>
<span class="line" id="L1037">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1038">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1039">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.none);</span>
<span class="line" id="L1040">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1041">        },</span>
<span class="line" id="L1042">        .memcpy =&gt; {</span>
<span class="line" id="L1043">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1044">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1045">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1046">        },</span>
<span class="line" id="L1047">        .memset =&gt; {</span>
<span class="line" id="L1048">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1049">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1050">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1051">        },</span>
<span class="line" id="L1052">        .shuffle =&gt; {</span>
<span class="line" id="L1053">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1054">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1055">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.none);</span>
<span class="line" id="L1056">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.none);</span>
<span class="line" id="L1057">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1058">        },</span>
<span class="line" id="L1059">        .select =&gt; {</span>
<span class="line" id="L1060">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1061">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1062">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.none);</span>
<span class="line" id="L1063">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.none);</span>
<span class="line" id="L1064">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1065">        },</span>
<span class="line" id="L1066">        .async_call =&gt; {</span>
<span class="line" id="L1067">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1068">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.none);</span>
<span class="line" id="L1069">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.none);</span>
<span class="line" id="L1070">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.none);</span>
<span class="line" id="L1071">            <span class="tok-kw">return</span> <span class="tok-null">false</span>; <span class="tok-comment">// buffer passed as arg for frame data</span>
</span>
<span class="line" id="L1072">        },</span>
<span class="line" id="L1073">        .Vector =&gt; {</span>
<span class="line" id="L1074">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1075">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1076">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1077">        },</span>
<span class="line" id="L1078">        .prefetch =&gt; {</span>
<span class="line" id="L1079">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1080">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1081">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1082">        },</span>
<span class="line" id="L1083">        .c_va_arg =&gt; {</span>
<span class="line" id="L1084">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1085">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1086">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1087">        },</span>
<span class="line" id="L1088">        .c_va_copy =&gt; {</span>
<span class="line" id="L1089">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1090">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1091">        },</span>
<span class="line" id="L1092">        .c_va_end =&gt; {</span>
<span class="line" id="L1093">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1094">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1095">        },</span>
<span class="line" id="L1096">        .cmpxchg_strong, .cmpxchg_weak =&gt; {</span>
<span class="line" id="L1097">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">0</span>], block, ResultInfo.none);</span>
<span class="line" id="L1098">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">1</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1099">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">2</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1100">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">3</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1101">            _ = <span class="tok-kw">try</span> astrl.expr(args[<span class="tok-number">4</span>], block, ResultInfo.type_only);</span>
<span class="line" id="L1102">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L1103">        },</span>
<span class="line" id="L1104">    }</span>
<span class="line" id="L1105">}</span>
<span class="line" id="L1106"></span>
</code></pre></body>
</html>